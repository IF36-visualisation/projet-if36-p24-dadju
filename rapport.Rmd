---
title: "Exploration cin√©matographique"
author: "Elo√Øse LAPLANCHE, Laure PENG, Gaudeline Maeva SIMO KAMWA, Belvine YEMDJO YOUMBI"
output:
  prettydoc::html_pretty:
    theme: adapta
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r library}
library(ggplot2)
library(tibble)
library(tidyr)
library(lubridate)
library(dplyr)
library(readr)
library(forcats)
library(prettydoc)
library(stringr)
library(tidyverse)
library(plotly)
library(kableExtra)
library(scales)
library(leaflet)
library(countrycode)
library(htmltools)
library(viridis)
library(RColorBrewer)
library(tm)
library(wordcloud)
```

```{r data}
data <- read_csv("data/movies.csv")
```


# Introduction

üé• Bienvenue dans le projet d'exploration cin√©matographique ! üé•

Une √©tude bas√©e sur la visualisation de donn√©es üìà pour d√©couvrir le dessous des films √† succ√®s ‚≠ê

L'√©quipe üöÄ 

- Elo√Øse LAPLANCHE 

- Laure PENG 

- Gaudeline Maeva SIMO KAMWA 

- Belvine YEMDJO YOUMBI

## Donn√©es

Nous avons choisi d‚Äô√©tudier un dataset regroupant des donn√©es sur les films √† succ√®s. Ce jeu de donn√©es a √©t√© trouv√© sur Kaggle et a √©t√© modifi√© par nos soins pour garder uniquement les features qui nous importent dans cette √©tude. 

Le choix de travailler sur des donn√©es li√©es au monde du cin√©ma r√©sulte de l‚Äôenvie de la part des membres de notre √©quipe de d√©couvrir plus en d√©tail cet univers. Toutes les quatre amatrices de films, ce jeu de donn√©es sera pour nous l‚Äôoccasion de travailler sur un sujet qui nous int√©resse et qui nous intrigue.


- Nombre d‚Äôobservations : 4803

- Nombre de variables : 17

- Source : https://www.kaggle.com/datasets/harshshinde8/movies-csv

- Auteur : Harsh Shinde [üîó](https://www.linkedin.com/in/harshshinde/)

D√©tail des donn√©es : 

| Variable                | Type     | Description                                |
|-------------------------|----------|--------------------------------------------|
| budget                  | `Int`    | Budget global pour r√©aliser le film        |
| genres                  | `String` | Genres associ√©s au film                    |
| keywords                | `String` | Mots-cl√©s repr√©sentant le film             |
| overview                | `String` | Synopsis du film                           |
| popularity              | `Float`  | Popularit√© du film (entre 0 et 876)        |
| production_companies    | `String` | Liste des soci√©t√©s de productions          |
| production_countries    | `String` | Liste des pays de production               |
| release_date            | `Date`   | Date de sortie du film                     |
| revenue                 | `Int`    | Revenus g√©n√©r√©s par le film                |
| runtime                 | `Float`  | Dur√©e du film (en minutes)                 |
| spoken_languages        | `String` | Liste des langues parl√©es dans le film     |
| tagline                 | `String` | ‚ÄúSlogan‚Äù du film                           |
| title                   | `String` | Titre du film                              |
| vote_average            | `Float`  | Moyenne de la note attribu√©e (entre 0 et 10)|
| vote_count              | `Int`    | D√©compte du nombre de votes (entre 0 et 13752)|
| cast                    | `String` | Liste des noms des acteurs du film         |
| director                | `String` | Nom du r√©alisateur du film                 |


On peut relever dans ce dataset plusieurs grands groupes de donn√©es : 

- Les donn√©es de **description du film** (*genres, keywords, overview, tagline, title*)

- Les donn√©es concernant la **r√©alisation du film** (*director, cast, spoken_languages, runtime, release_date, production_countries, production_companies, budget*)

- Les donn√©es sur les **retomb√©es du film** (*popularity, revenue, vote_average, vote_count*)

## Plan d'analyse

Ce dataset √©tant assez riche, nous pouvons √©laborer un plan d‚Äôanalyse selon plusieurs grands axes d‚Äô√©tude :

### Analyse du succ√®s des films

Dans cette partie, on s‚Äôinterrogera sur les facteurs qui pourraient ressortir lorsqu‚Äôun film a du succ√®s. Pour cela, on peut se baser sur nos indicateurs de popularit√© et de note moyenne et les comparer avec d‚Äôautres features comme le genre du film, le r√©alisateur ou le budget. Dans cette partie, il faudra veiller √† bien mettre en regard la note du film avec le nombre de votants, afin de ne pas avoir d'analyse biais√©e par un nombre de votants trop faible sur un film par exemple.

***Attentes :*** On peut supposer que plus le r√©alisateur est connu ou que plus le budget est important, et plus le film sera populaire et obtiendra une bonne note. Nous pensons √©galement que les films d'actions seront sans doute les films avec le plus de succ√®s.

***Exemples de questions :***

**Succ√®s du film :** 

- Quels sont les r√©alisateurs les plus populaires en fonction du genre (ou en fonction du nombre de films r√©alis√©s) ?

- Quel genre de film g√©n√®re le plus de revenus ?

- Quels sont les genres les plus populaires ?

- Est-ce qu'il y a un lien entre les acteurs et la popularit√© ou la note du film ?
  
**Appr√©ciation du film :**

- Est-ce qu‚Äôil y a un lien entre le budget et la note ?

- Est-ce qu'il y a un lien entre la r√©alisation de plusieurs films du m√™me genre et la note du film ?

- Est ce que la langue originale du film a une influence ?

- Y-a-t-il un lien entre popularit√© et note du film ?


###  Analyse des tendances temporelles
Nous pourrons ici analyser plusieurs features en regard des dates de sortie du film. On pourra ou non constater des √©volutions de genre, de r√©alisateurs ou encore de soci√©t√©s de production en fonction du temps afin de voir si de nouveaux sch√©mas se dessinent. Nos donn√©es vont de 1916 √† 2017, mais nous poss√©dons un nombre de films sup√©rieur √† 100 qu'√† partir de 1993, il faudra donc faire attention lors de l'analyse.

***Attentes :*** On peut supposer que les grosses soci√©t√©s de production perdurent au fil du temps et qu'au contraire, les petites soci√©t√©s laissent place √† d'autres. On pourra aussi v√©rifier s'il existe des pays "√† la mode" sur certaines ann√©es. On s'attend √©galement √† une √©volution du budget des soci√©t√©s dans le temps.

***Exemples de questions :***

- Quels sont les pays qui ont r√©alis√© le plus de films en fonction des ann√©es ?

- Est-ce qu‚Äôil y a une √©volution de la popularit√© des films dans le temps ?

- Est-ce que l'ann√©e de r√©alisation impacte sur le genre du film ?

- Est-ce que le budget a √©volu√© au fil des ann√©es ?

- Est-ce qu‚Äôil y a une √©volution de la dur√©e des films dans le temps ?

- Est-ce qu'il y a un lien entre le budget d'un film et sa dur√©e ?

- Est-ce qu'il y a une diff√©rence de dur√©e des films dans chaque pays ?

- Est-ce que les maisons de production ont vari√© le genre de leurs films au fil du temps ?

### Analyse des mots employ√©s pour d√©crire le film
Ici, on pourrait analyser les features telles que le slogan, le titre, le synopsis et les mots-cl√©s pour trouver des liens et faire ressortir des patterns. On pourra aussi √©valuer si le choix de ces mots a une influence sur l'appr√©ciation ou la note du film. Le traitement de donn√©es textuelles peut √™tre certaines fois d√©licat, il faudra donc veiller √† ce que les techniques de traitement soient appropri√©es et les biais identifi√©s.

***Attentes :*** On pense trouver des mots-cl√©s qui ressortent selon le genre du film. On peut aussi imaginer que selon la compagnie de production ou le r√©alisateur, des mots-cl√©s peuvent √™tre repris dans les films qu'ils produisent, comme une marque de fabrique.

***Exemples de questions :***

- Est-ce qu‚Äôil y a des mots que l‚Äôon retrouve le plus dans le titre selon le genre du film ?

- Quels sont les mots-cl√©s les plus fr√©quents en fonction du genre ?

- Est-ce que certains mots-cl√©s ressortent dans les films de telle ou telle compagnie de production ou pour tel r√©alisateur ? Cela a-t-il un lien avec le pays de production ?

- Est-ce que les mots-cl√©s utilis√©s ont une influence sur l'appr√©ciation ou la note du film ?



# Exploration


### Appr√©ciation du film

Nous allons nous interroger dans un premier temps sur le lien que l'on peut avoir entre la note attribu√©e par les utilisateurs au film et sa popularit√©.
Dans le dataset r√©cup√©r√©, il n'est pas explicit√© clairement √† quoi correspond la popularit√© du film. Nous prenons donc le parti de dire que la popularit√© correspond au volume d'activit√© li√© au film, c'est √† dire si les personnes le regardent, peu importe qu'elles l'appr√©cient ou non.

On s'attend √† ce que plus un film est populaire, et plus sa note moyenne est √©lev√©e. 

Tout d'abord, on effectue une rapide analyse de nos donn√©es pr√©sentes pour ces deux features. Comme il s'agit de variables quantitatives continues, on les pr√©sente √† travers un histogramme.

```{r analyse note}
ggplot(data = data, mapping = aes(x = vote_average)) +
  geom_histogram(bins = 30, fill = "#69b3a2") +
  labs(title = "R√©partition des notes moyennes attribu√©es aux films",
       x = "Note moyenne obtenue",
       y = "Nombre d'occurrences") 
```

Nous constatons que les donn√©es semblent coh√©rentes, except√©es celles qui ont une note moyenne de 0. En effet, il est difficilement concevable de penser qu'un film jug√© par plusieurs personnes se voit attribuer la note moyenne de 0. On peut imaginer qu'il s'agissait de valeurs manquantes mises √† 0 dans le dataset.
Nous prendrons donc le parti, pour la question du lien entre popularit√© et note, de retirer les lignes qui ont une note de 0. On utilise une technique d'extraction sous conditions pour faire cela.

```{r analyse popularit√©}
data_filtered_1 <- subset(data, popularity < 150)

ggplot(data = data_filtered_1, mapping = aes(x = popularity)) +
  geom_histogram(bins = 30, fill = "#69b3a2") +
  labs(title = "R√©partition de la popularit√© attribu√©e aux films",
       x = "Popularit√© attribu√©e",
       y = "Nombre d'occurrences")
```


Ici la popularit√© a √©t√© filtr√©e avec la m√™me technique que pour la note, pour ne s√©lectionner que les films avec un popularit√© inf√©rieure √† 150. En effet, seules 19 valeurs sont au dessus de cette limite que nous nous fixons. La popularit√© moyenne est de `r round(mean(data$popularity[data$popularity < 150]), 1)`.


Pour obtenir un graphique lisible par la suite, nous allons calculer la popularit√© moyenne en fonction de la note moyenne. Pour cela, nous commen√ßons par cr√©er des intervalles de note de 0.5 en 0.5, puis nous dispachons nos donn√©es dans les intervalles correspondant avant de faire la moyenne de la popularit√© pour chaque intervalle. La popularit√© moyenne est donc une variable quantitative continue, et apr√®s modification, la note moyenne devient une variable qualitative ordonn√©e.

Comme on souhaite comparer ces deux √©l√©ments, on r√©alisera un diagramme en barres. Nous ajustons la largeur des barres pour que le graphique soit plus agr√©able √† lire.

```{r comparaison_note_popularite}

intervalles <- seq(0, 10, by = 0.5)

data_grouped <- data %>%
  filter(popularity < 150, vote_average != 0) %>%
  group_by(vote_intervalle = cut(vote_average, breaks = intervalles, right = FALSE)) %>%
  summarize(mean_popularity = mean(popularity))

ggplot(data = data_grouped, aes(x = vote_intervalle, y = mean_popularity)) +
  geom_bar(stat = "identity", fill = "skyblue", width = 0.8) +
   scale_x_discrete(labels = paste0(intervalles, " - ", intervalles + 0.5)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(x = "Note moyenne", y = "Popularit√© moyenne", 
       title = "Popularit√© moyenne par tranche de note de 0.5")
```

**Analyse**

Les r√©sultats obtenus sont conformes avec ce que l'on attendait. En effet, on constate que plus la note est √©lev√©e, et plus la popularit√© augmente. 

En revanche, on voit que pour les notes tr√®s √©lev√©es (8,5+), la popularit√© est proche de 0, ce qui ne semble pas normal de prime abord. Cependant, si l'on recoupe ce graphique avec celui montrant la distribution des notes, on constate que tr√®s peu de r√©ponses sont enregistr√©es pour les intervalles de 0 √† 2,5 et 8,5 √† 10. Ceci explique que la popularit√© moyenne attribu√©e soit aussi basse. Pour r√©soudre ce probl√®me, il faudrait pouvoir collecter plus de donn√©es sur les films qui obtiennent une excellente note (ce qui est par ailleurs rare).


---


Maintenant que nous avons montr√© le lien entre la note et la popularit√© du film, nous allons nous pencher sur l'√©tude de la distribution du budget par tranches de notes. Il est int√©ressant d'essayer de comprendre ce qui peut jouer dans la note qu'attribue un utilisateur √† un film.

Nous nous attendons plut√¥t √† ce qu'un film avec un budget important obtienne une bonne note, m√™me si l'on sait que des films √† faible budget sont aussi capables d'avoir de bonnes notes et inversement.

Commen√ßons par analyser le budget, qui est une variable quantitative continue, √† l'aide d'un histogramme.

```{r analyse budget}
ggplot(data = data, mapping = aes(x = budget)) +
  geom_histogram(bins = 60, fill = "#69b3a2") +
  scale_x_continuous(labels = function(x) sprintf("%.0f M", x / 1e6)) +
  labs(title = "R√©partition du budget attribu√© aux films",
       x = "Budget attribu√© (en M de $)",
       y = "Nombre d'occurrences")
```

On constate que plus de 1500 films ont un budget de 0, ce qui n'est pas concevable. Nous allons donc exclure ces donn√©es enregistr√©es √† 0 par extraction conditionnelle pour la suite de l'analyse, afin de ne pas fausser les r√©sultats. En effet, un film co√ªte forc√©ment de l'argent pour √™tre r√©alis√©. 

Nous avons √† disposition le budget qui est une variable quantitative continue, et la note que l'on laisse sous la forme de variable qualitative ordonn√©e.

Puisque l'on souhaite faire une distribution, on utilise un boxplot (la moyenne, √† titre indicatif, est repr√©sent√©e par un point bleu). 

Avant de cr√©er ce boxplot, plusieurs pr√©traitements sont n√©cessaires. Outre l'extraction conditionnelle, nous devons aussi cr√©er des intervalles de notes de 1 √† 10 par pas de 1 pour que nous graphique soit plus lisible. Nous r√©partissons ensuite ces donn√©es dans ces tranches avant d'effectuer la distribution.

Pour plus de lisibilit√©, le diagramme suivant est interactif afin de pourvoir zoomer sur certaines parties, et obtenir les valeurs correspondantes. 

```{r comparaison_note_budget}

data_filtered <- data[data$budget != 0 & data$vote_average != 0, ]
intervalles <- seq(0, 10, by = 1)
plot_interactif_1 <- ggplot(data = data_filtered, aes(x = cut(vote_average, breaks = intervalles), y = budget)) +
    geom_boxplot(fill = "skyblue", color = "black", size = 0.3) +  
    stat_summary(fun = "mean", geom = "point", shape = 20, size = 2, color = "darkblue") +
    labs(x = "Note obtenue", y = "Budget du film (en M de $)", title = "Distribution du budget des films en fonction de la note obtenue par tranche de 1") +
    scale_y_continuous(labels = function(x) sprintf("%.1f M", x / 1e6)) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
plotly_plot <- ggplotly(plot_interactif_1, tooltip = c())
plotly_plot

```

**Analyse**

On constate que finalement, ce ne sont pas forc√©ment les films avec le plus gros budget qui obtiennent la meilleure note. 

Les budgets m√©dians les plus √©lev√©s sont pour les notes comprises entre 5 et 7, ce qui signifie qu'il n'existe pas de relation claire entre le budget d'un film et sa note. Un budget plus faible, comme c'est le cas pour la m√©diane des notes de 2 √† 5 et de 7 √† 9, peut donner un tr√®s bon film comme un mauvais film aux yeux des spectateurs. 

Ici, les outliers sont int√©ressants puisque l'on constate que plusieurs tr√®s gros budgets m√®nent √† une note correcte voire tr√®s bonne.On en recense pas d'outliers qui aurait un budget tr√®s important et une note tr√®s basse, ce qui pourrait vouloir dire qu'u budget √©lev√© garantirait en quelques sortes une note acceptable. 

La moyenne est en accord avec les r√©sultats √©voqu√©s apr√®s analyse de la m√©diane, √† savoir que les films avec une note bonne mais pas excellente, on en moyenne le budget le plus √©lev√©.

Les donn√©es des notes 1,2 et 9,10 sont √† relativiser puisque tr√®s peu d'observations sont faites sur ces intervalles. 

On comprend avec cette visualisation que le budget seul ne peut pas expliquer une bonne ou mauvaise note, que d'autres facteurs entrent certainement en jeu. Cependant, lorsqu'un film est en pr√©paration, il faut r√©fl√©chir √† sa rentabilit√©, √† l'√©quilibre financier. M√™me si une bonne note pourrait inciter les personnes √† acheter ou aller voir le film, il est envisageable d'aller au cin√©ma pour voir un film avec beaucoup d'actions ou un gros casting, m√™me si la note n'est pas exceptionnelle par exemple. Dans ce cas, il faudrait nous int√©resser plut√¥t √† la popularit√© du film qu'√† sa note.

---

Maintenant que nous avons analys√© la distribution du budget en fonction de la note, nous allons essayer de comparer le budget et la popularit√©. 

En effet, nous pensons qu'un film avec un gros budget peut √™tre populaire dans l'esprit collectif. Lorsque l'on voit qu'un film s'est vu attribuer un budget cons√©quent, on peut esp√©rer un beau casting, des d√©cors travaill√©s ou encore une animation attractive, et donc √™tre amen√©s √† vouloir visionner ce film. 

On s'attend donc √† ce que plus un film a un gros budget, et plus il soit populaire. 

Comme nous souhaitons faire une comparaison, nous allons r√©aliser un scatter plot. Nous ajustons la transparence des points afin d'√©galement visualiser la densit√© des donn√©es sur certains intervalles. Nous cr√©ons √©galement une courbe de tendance √† titre indicatif. Enfin nous pr√©traitons nos donn√©es en amont pour n'extraire que les individus avec une popularit√© inf√©rieure √† 150 et un budget diff√©rent de 0.

```{r comparaison_popularite_budget_1}
data_filtered_1 <- subset(data, popularity < 150 & budget != 0)

ggplot(data = data_filtered_1, aes(x = budget, y = popularity)) +
  geom_point(colour = "darkorange", size = 3, alpha = 0.4) + 
  geom_smooth(method = "lm", se = FALSE, color = "black", linetype = 2) +
  scale_x_continuous(labels = function(x) sprintf("%.0f M", x / 1e6)) +
  labs(x = "Budget du film (en M de $)", y = "Popularit√©", title = "Popularit√© en fonction du budget des films") +
  theme_gray() 

```

On observe sur cette visualisation une tendance g√©n√©rale o√π plus le budget est important et plus la popularit√© est grande. Comme nous avons beaucoup de donn√©es en dessous de 100M de dollars de budget, il est difficile de bien √©valuer cette partie. 

Pour une approche un peu diff√©rente, nous cr√©ons des tranches de 10M de dollars et nous calculons pour chaque tranche la popularit√© moyenne. 


```{r comparaison_popularite_budget_2}

data_filtered_1 <- subset(data, popularity < 150 & budget != 0)
tranches <- seq(0, max(data_filtered_1$budget), by = 5e6)

data_aggregated <- data_filtered_1 %>%
  mutate(budget_tranche = cut(budget, breaks = tranches)) %>%
  group_by(budget_tranche) %>%
  summarise(mean_popularity = mean(popularity, na.rm = TRUE))

ggplot(data = data_aggregated, aes(x = as.numeric(budget_tranche), y = mean_popularity)) +
  geom_point(colour = "#69b3a2", size = 3) + 
  geom_smooth(method = "lm", se = FALSE, color = "darkgreen", linetype = 2) +
  scale_x_continuous(labels = function(x) x * 5) +
  labs(x = "Budget du film (en millions de dollars)", y = "Popularit√© moyenne", title = "Popularit√© moyenne en fonction du budget des films") +
  theme_gray() 

```


**Analyse**

Ce processus nous permet de mettre encore plus en √©vidence la corr√©lation entre le budget et la popularit√©. Plus le budget est √©lev√©, et plus la popularit√© l'est. 

Nous nous attendions √† ce r√©sultat avant de r√©aliser le graphique. En effet, il est courant qu'un film qui est attendu avec un gros budget soit populaire m√™me si ce n'est pas le film de l'ann√©e. Cela rejoint ce que nous avions pens√© suite √† l'√©tude du lien potentiel entre la note et le budget.  

Dans le budget, on comprend √† la fois la r√©mun√©ration des acteurs, des techniciens, des figurants, des r√©alisateurs, mais aussi tout ce qui touche √† la musique, l'√©clairage, la postproduction, le mat√©riel, la r√©gie, les assurances ou encore les droits artistiques et les actions de promotion. Engager un budget cons√©quent signifie donc tr√®s certainement de s'attendre √† une retomb√©e financi√®re importante. C'est ce que nous allons essayer de voir dans la question suivante. 

---

Nous v√©rifions ce point en commen√ßant d'abord par enlever de notre dataset les budgets ou les revenus qui valent 0. Ensuite, nous cr√©ons des tranches de 20M pour le budget, et nous calculons pour chaque tranche le revenu moyen. Le revenu moyen est une variable quantitative continue, et apr√®s modification, les tranches de budget deviennent une variable qualitative ordonn√©e.Comme on souhaite comparer ces deux √©l√©ments, on r√©alisera un diagramme en barres annot√© pour plus de lisibilit√©.


```{r comparaison_revenus_budget_3}

data_filtered_1 <- subset(data, budget != 0 & revenue != 0)
tranches <- seq(0, max(data_filtered_1$budget), by = 20e6)

data_aggregated <- data_filtered_1 %>%
  mutate(budget_tranche = cut(budget, breaks = tranches)) %>%
  group_by(budget_tranche) %>%
  summarise(mean_revenue = mean(revenue, na.rm = TRUE))

ggplot(data = data_aggregated, aes(x = as.numeric(budget_tranche), y = mean_revenue)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  geom_text(aes(label = sprintf("%.1f", mean_revenue / 1e6)), vjust = -0.5, size = 3) +
  scale_x_continuous(labels = function(x) x * 20) +
  scale_y_continuous(labels = function(x) x / 1e6) +
  labs(x = "Budget du film (en millions de dollars par tranches de 20M)", y = "Revenus moyen (en millions de dollars)", title = "Revenus moyen en fonction du budget des films par tranche de 20M de $") +
  theme_gray()

```

**Analyse**

Comme pr√©vu, plus le budget du film augmente et plus les revenus augmentent. Le trou observ√© entre 320 et 360M de dollars sur le budget correspond √† un manque de donn√©es poour ces budgets l√†.

On constate √©galement un chiffre anormalement √©lev√© pour les revenus √† 1 123M de dollars. Si l'on se penche un peu plus en d√©tail sur les donn√©es, on constate que pour cette tranche l√†, se trouve le film Avatar sorti en 2009, qualifi√© du "plus gros succ√®s cin√©matographique de tous les temps". Il d√©tient le record de recettes, estim√©es √† 2,7 milliards de dollars. Ce chiffre √©tant tr√®s important, il influe forc√©ment sur la moyenne calcul√©e, d'o√π le pic observ√© pour cette tranche. 

Nous n'avons malheureusement pas le d√©tail des recettes obtenues par pays, ni le d√©tail du budet des films, ce qui aurait pu √™tre int√©ressant pour poursuivre notre analyse et l'approfondir. N√©anmoins, nous avons prouv√© √† travers cette question qu'un budget plus cons√©quent a tendance √† √™tre synonyme de recettes importantes.


---


### Succ√®s du film

Nous allons ensuite nous interroger sur les r√©alisateurs les plus populaires en fonction du genre du film.

Pour cela, on r√©cup√®re tout d'abord les genres des films contenus dans le dataset.

```{r data_director_popularity}
data_dirpop <- data.frame(genre=c(), director=c(), popularity=c())

clean_data <- data %>% 
  select(genres, popularity, director) %>%
  arrange(desc(popularity))

genres_0 <- data %>% select(genres)
genres <- c()
for (i in 1:4803) { 
  genres_split <- unlist(str_split(genres_0[i,], ' '))
  if ("Science" %in% genres_split) {
    genres_split <- genres_split[(genres_split != "Science") & (genres_split != "Fiction")]
    genres_split[length(genres_split)+1] <- "Science Fiction"
    
  }
  genres[i] <- list(genres_split)
}

genre_list <- c()
j <- 1
for (elemt_0 in genres) {
  for (elmt_1 in elemt_0) {
    if ((!(elmt_1 %in% genre_list)) &(!(elmt_1 %in% NA))) {
      genre_list[j] <- elmt_1
      j <- j+1
    }
  }
}

for (genre in genre_list) {
    film_filtered <- clean_data %>%
                      filter(str_detect(genres, genre))
    for (j in 1:3) {
      tabgenre <- genre
      tabdir <- film_filtered$director[j]
      tabpop <- film_filtered$popularity[j]
      data_dirpop <- rbind(data_dirpop, data.frame(genre=tabgenre, 
                                                   director=tabdir, 
                                                   popularity=tabpop))
    }
}

print(genre_list)
```

On obtient ainsi, `r length(genre_list)` genres cin√©matographiques diff√©rents. Comme les donn√©es sont quantitatives continues (popularit√©) ou qualitatives (genre), on les pr√©sente en 3 graphiques en barres circulaires (circular barplot) selon le degr√© de popularit√© des films de chaque genre (grande popularit√©, popularit√© moyenne, faible popularit√©).

```{r data_director_popularity_ordered}
pop_max_by_genre <- c()
i <- 1
for (genree in genre_list) {
  pop_max_by_genre[i] <- max((data_dirpop %>% filter(genre == genree))$popularity)
  i <- i+1
}

data_dirpop1 <- data.frame(genre=c(), director=c(), popularity=c())
data_dirpop2 <- data.frame(genre=c(), director=c(), popularity=c())
data_dirpop3 <- data.frame(genre=c(), director=c(), popularity=c())

j <- 1
for (genre in genre_list) {
  for (k in 1:3) {
    genre_ordered <- genre
    director_ordered <- data_dirpop$director[3*(j-1)+k]
    popularity_ordered <- data_dirpop$popularity[3*(j-1)+k]
      
    if (pop_max_by_genre[j] > 450) {
      data_dirpop1 <- rbind(data_dirpop1, data.frame(genre=genre_ordered, 
                                                     director=director_ordered, 
                                                     popularity=popularity_ordered))
    } else if (pop_max_by_genre[j] > 100) {
      data_dirpop2 <- rbind(data_dirpop2, data.frame(genre=genre_ordered, 
                                                     director=director_ordered, 
                                                     popularity=popularity_ordered))
    } else {
      data_dirpop3 <- rbind(data_dirpop3, data.frame(genre=genre_ordered, 
                                                     director=director_ordered, 
                                                     popularity=popularity_ordered))
    }
  }
    j <- j+1
}
```

```{r graph_director_popularity_by_genre1}
empty_bar <- 2
genre_to_add <- rep(levels(factor(data_dirpop1$genre)), each=empty_bar)
to_add <- data.frame(genre=genre_to_add, director=NA, popularity=NA)

data_dirpop1 <- rbind(data_dirpop1, to_add)
data_dirpop1 <- data_dirpop1 %>% arrange(genre)
data_dirpop1$id <- seq(1, nrow(data_dirpop1))

label_data <- data_dirpop1
number_of_bar <- nrow(label_data)
angle <- 90 - 360 * (label_data$id-0.5) / number_of_bar
label_data$hjust <- ifelse(angle < -90, 1, 0)
label_data$angle <- ifelse(angle < -90, angle+180, angle)

base_data <- data_dirpop1 %>%
  group_by(genre) %>%
  summarize(start=min(id), end=max(id) - empty_bar) %>%
  rowwise() %>%
  mutate(title=mean(c(start, end)))

grid_data <- base_data
grid_data$end <- grid_data$end[c(nrow(grid_data), 1:nrow(grid_data)-1)] + 1
grid_data$start <- grid_data$start - 1
grid_data <- grid_data[-1,]

ggplot(data_dirpop1, aes(x=as.factor(id), y=popularity, fill=genre)) +
  geom_bar(aes(x=as.factor(id), y=popularity, fill=genre), stat="identity", alpha=0.5) +
  
  geom_segment(data=grid_data, aes(x = end, y = 800, xend = start, yend = 800), 
               colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = end, y = 600, xend = start, yend = 600), 
               colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = end, y = 400, xend = start, yend = 400), 
               colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = end, y = 200, xend = start, yend = 200), 
               colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  
  ggplot2::annotate("text", x = rep(max(data_dirpop1$id),4), y = c(200, 400, 600, 800), 
           label = c("200", "400", "600", "800") , color="grey", size=2.8 , 
           angle=0, fontface="bold", hjust=0.9) +
  
  geom_bar(aes(x=as.factor(id), y=popularity, fill=genre), stat="identity", alpha=0.5) +
  ylim(-500, 1300) +
  theme_minimal() + 
  theme(
    legend.position = "none",
    axis.text = element_blank(),
    axis.title = element_blank(),
    panel.grid = element_blank(),
    plot.margin = unit(rep(-1,4), "cm"),
    plot.title = element_text(size=12, face="bold", colour="black", vjust=-15, hjust=0.5)
  ) +
  coord_polar() +
  geom_text(data=label_data, aes(x=id, y=popularity+10, label=director, hjust=hjust), 
            color="black", fontface="bold", alpha=0.6, size=3, angle=label_data$angle, 
            inherit.aes = FALSE) +
  
  geom_segment(data = base_data, aes(x = start, y = -20, xend = end, yend = -20), 
               colour = "gray25", alpha = 0.8, size = 0.3, inherit.aes = FALSE) +
  geom_text(data = base_data, aes(x = title, y = -18, label = genre), colour = "gray10", 
            alpha = 0.8, size = 2.5, fontface="bold", hjust=c(0.3, 1, 1.05, 0.5, 0, -0.1, 0.3), 
            vjust=c(1.7, 1.9, -0.4, -0.9, -0.6, 0, 2.5), inherit.aes = FALSE) +
  labs(title = "R√©alisateurs les plus populaires par genre de film (√† grande popularit√©)")
```

Les genres √† grande popularit√© sont les genres dont les films ont une popularit√© sup√©rieure 450. Ainsi, on retrouve des r√©alisateurs comme Kyle Balda, populaire dans les films d'aventure, d'animation, de com√©die et de famille, ou Christopher Nolan, dans les films d'aventure, de science-fiction et les drames. Cependant, on remarque que la popularit√© de certains r√©alisateurs est la m√™me dans plusieurs genres, car elle d√©coule d'un film ayant plusieurs genres.

```{r graph_director_popularity_by_genre2}
empty_bar <- 2
genre_to_add <- rep(levels(factor(data_dirpop2$genre)), each=empty_bar)
to_add <- data.frame(genre=genre_to_add, director=NA, popularity=NA)

data_dirpop2 <- rbind(data_dirpop2, to_add)
data_dirpop2 <- data_dirpop2 %>% arrange(genre)
data_dirpop2$id <- seq(1, nrow(data_dirpop2))

label_data <- data_dirpop2
number_of_bar <- nrow(label_data)
angle <- 90 - 360 * (label_data$id-0.5) / number_of_bar
label_data$hjust <- ifelse(angle < -90, 1, 0)
label_data$angle <- ifelse(angle < -90, angle+180, angle)

base_data <- data_dirpop2 %>%
  group_by(genre) %>%
  summarize(start=min(id), end=max(id) - empty_bar) %>%
  rowwise() %>%
  mutate(title=mean(c(start, end)))

grid_data <- base_data
grid_data$end <- grid_data$end[c(nrow(grid_data), 1:nrow(grid_data)-1)] + 1
grid_data$start <- grid_data$start - 1
grid_data <- grid_data[-1,]

ggplot(data_dirpop2, aes(x=as.factor(id), y=popularity, fill=genre)) +
  geom_bar(aes(x=as.factor(id), y=popularity, fill=genre), stat="identity", alpha=0.5) +
  
  geom_segment(data=grid_data, aes(x = end, y = 400, xend = start, yend = 400), 
               colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = end, y = 300, xend = start, yend = 300), 
               colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = end, y = 200, xend = start, yend = 200), 
               colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = end, y = 100, xend = start, yend = 100), 
               colour = "grey", alpha=1, size=0.3 , inherit.aes = FALSE ) +
  
  ggplot2::annotate("text", x = rep(max(data_dirpop2$id),4), y = c(100, 200, 300, 400), 
           label = c("100", "200", "300", "400") , color="grey", size=2.8 , angle=0, 
           fontface="bold", hjust=0.8) +
  
  geom_bar(aes(x=as.factor(id), y=popularity, fill=genre), stat="identity", alpha=0.5) +
  ylim(-230, 600) +
  theme_minimal() + 
  theme(
    legend.position = "none",
    axis.text = element_blank(),
    axis.title = element_blank(),
    panel.grid = element_blank(),
    plot.margin = unit(rep(-1,4), "cm"),
    plot.title = element_text(size=12, face="bold", colour="black", vjust=-11, hjust=0.5)
  ) +
  coord_polar() +
  geom_text(data=label_data, aes(x=id, y=popularity+10, label=director, hjust=hjust), 
            color="black", fontface="bold", alpha=0.6, size=3, angle=label_data$angle, 
            inherit.aes = FALSE) +
  
  geom_segment(data = base_data, aes(x = start, y = -5, xend = end, yend = -5), 
               colour = "gray25", alpha = 0.8, size = 0.3, inherit.aes = FALSE) +
  geom_text(data = base_data, aes(x = title, y = -18, label = genre), colour = "gray10", 
            alpha = 0.8, size = 2.7, fontface="bold", hjust=c(0.4, 0.9, 1, 0.8, 0.5, 0.4, 0, 0, 0.5), 
            vjust=c(1.3, 1.2, 0, -0.5, -0.3, -0.9, -0.3, 0.9, 1.6), angle=0, inherit.aes = FALSE) +
  labs(title="R√©alisateurs les plus populaires par genre de film (√† popularit√© moyenne)")
```

Ici, les genres √† popularit√© moyenne sont les genres dont les films ont une popularit√© entre 450 et 100. On retrouve Christopher Nolan, √©galement populaire dans les films √† √©nigme, ou George Miller et Colin Trevorrow, tr√®s populaires dans les thriller.

```{r graph_director_popularity_by_genre3}
empty_bar <- 2
genre_to_add <- rep(levels(factor(data_dirpop3$genre)), each=empty_bar)
to_add <- data.frame(genre=genre_to_add, director=NA, popularity=NA)

data_dirpop3 <- rbind(data_dirpop3, to_add)
data_dirpop3 <- data_dirpop3 %>% arrange(genre)
data_dirpop3$id <- seq(1, nrow(data_dirpop3))

label_data <- data_dirpop3
number_of_bar <- nrow(label_data)
angle <- 90 - 360 * (label_data$id-0.5) / number_of_bar
label_data$hjust <- ifelse(angle < -90, 1, 0)
label_data$angle <- ifelse(angle < -90, angle+180, angle)

base_data <- data_dirpop3 %>%
  group_by(genre) %>%
  summarize(start=min(id), end=max(id) - empty_bar) %>%
  rowwise() %>%
  mutate(title=mean(c(start, end)))
base_data$id <- seq(1, nrow(base_data))

grid_data <- base_data
grid_data$end <- grid_data$end[c(nrow(grid_data), 1:nrow(grid_data)-1)] + 1
grid_data$start <- grid_data$start - 1
grid_data <- grid_data[-1,]

ggplot(data_dirpop3, aes(x=as.factor(id), y=popularity, fill=genre)) +
  geom_bar(aes(x=as.factor(id), y=popularity, fill=genre), stat="identity", alpha=0.5) +

  geom_segment(data=grid_data, aes(x = end, y = 80, xend = start, yend = 80), 
               colour = "grey", alpha=1, size=0.3, inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = end, y = 60, xend = start, yend = 60), 
               colour = "grey", alpha=1, size=0.3, inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = end, y = 40, xend = start, yend = 40), 
               colour = "grey", alpha=1, size=0.3, inherit.aes = FALSE ) +
  geom_segment(data=grid_data, aes(x = end, y = 20, xend = start, yend = 20), 
               colour = "grey", alpha=1, size=0.3, inherit.aes = FALSE ) +
  
  ggplot2::annotate("text", x = rep(max(data_dirpop3$id),4), y = c(20, 40, 60, 80), 
           label = c("20", "40", "60", "80") , color="grey", size=3, angle=0, 
           fontface="bold", hjust=1.6) +
  
  geom_bar(aes(x=as.factor(id), y=popularity, fill=genre), stat="identity", alpha=0.5) +
  ylim(-50, 90) +
  theme_minimal() + 
  theme(
    legend.position = "none",
    axis.text = element_blank(),
    axis.title = element_blank(),
    panel.grid = element_blank(),
    plot.margin = unit(rep(-1,4), "cm"),
    plot.title = element_text(size=12, face="bold", colour="black", vjust=-12, hjust=0.5)
  ) +
  coord_polar() +
  geom_text(data=label_data, aes(x=id, y=popularity+10, label=director, hjust=hjust), 
            color="black", fontface="bold", alpha=0.6, size=3, angle=label_data$angle, 
            inherit.aes = FALSE) +
  
  geom_segment(data = base_data, aes(x = start, y = -5, xend = end, yend = -5), 
               colour = "gray25", alpha = 0.8, size = 0.3, inherit.aes = FALSE) +
  geom_text(data = base_data, aes(x = title, y = -18, label = genre), colour = "gray10", 
            alpha = 0.8, size = 3, fontface="bold", hjust=c(0.4, 0.7, 0.5, 0.4, 0.8), 
            vjust=c(0.6, 0.2, 1, 0.8, 0), angle=0, inherit.aes = FALSE) +
  labs(title = "R√©alisateurs les plus populaires par genre de film (√† faible popularit√©)")
```

Enfin, les genres √† faible popularit√© sont les genres dont les films ont une popularit√© inf√©rieure √† 100. Ainsi, on 
remarque Elizabeth Banks, Rob Marshall et Ron Clements, populaires dans les films musicaux, ou Jeff Tremaine dans les films documentaires.

**Analyse**

Les r√©sulats obtenus nous permettent de percevoir les r√©alisateurs les plus populaires par genre cin√©matographique. Ils permettent √©galement de faire une premi√®re d√©duction des genres les plus populaires du dataset. N√©anmoins, on peut remarquer qu'en raison des multiples genres d√©finis pour chaque film, la popularit√© de certains films permet √† leurs r√©alisateurs de se d√©marquer dans plusieurs genres √† la fois. Ainsi, Kyle Balda a d√ª r√©alis√© un film faisant partie des genres Adventure, Animation, Comedy et Family, lui permettant d'√™tre class√© dans plusieurs genres. 
De plus, le dataset ne pr√©sente qu'une partie des films r√©alis√©s entre 1900 et 2020. Ainsi, ces r√©sultats ne concernent que les r√©alisateurs et genres pr√©sents dans ce dataset.

---


Maintenant que nous avons d√©terminer les r√©alisateurs les plus populaires par genre cin√©matographique, on peut se demander quels sont les genres les plus populaires.

On peut s'attendre √† ce que les films les plus populaires soient les films d'action, de science-fiction et les com√©dies.

Les donn√©es √©tant qualitatives (genres) et quantitatives continues (popularity), on ajoute la popularit√© de l'ensemble des films de m√™me genre afin d'obtenir un bar chart repr√©sentant la popularit√© de l'ensemble des films du dataset, r√©partie par genre. 

```{r sum_popularity_by_genre}
sum_pop <- c()
i <- 1
for (genre in genre_list) {
  sum_pop[i] <- sum((data %>%
                         select(genres, popularity) %>%
                         filter(grepl(genre, genres)))$popularity)
  i <- i+1
}

pop_by_genre <- data.frame(genre = genre_list, popularity = sum_pop)
pop_by_genre <- pop_by_genre %>%
  arrange(desc(popularity))
```

```{r bar_chart_popularity_by_genre}
pop_by_genre %>%
  mutate(name = fct_reorder(genre, popularity)) %>%
  ggplot( aes(x=name, y=popularity)) +
    geom_bar(stat="identity", fill="#69b3a2", width=.4) +
    coord_flip() +
    xlab("") +
    theme_bw() + 
    labs(x = "Genre", y = "Popularit√©", 
       title = "Popularit√© totale des films par genres")
```

On remarque donc que les genres semblant les plus populaires sont les drames, les films d'action, d'aventure, les com√©dies et les thrillers.

N√©anmoins, cette repr√©sentation peut √™tre biais√©e par le choix des films pr√©sents sur le dataset. On peut donc r√©aliser une distribution (box plot) de la popularit√© des films par genre. En raison du nombre important de genres pr√©sents, le graphique bo√Æte √† moustache sera divis√© en 3 selon la popularit√© maximale atteinte dans chaque genre. 

```{r data_popularity_by_genre}
data_pop <- data %>% select(genres, popularity)
genre_film <- c()
pop_film <- c()
j <- 1

for (i in 1:4803) {
  for (genres_list in genres[i]) {
    for (genre in genres_list) {
      genre_film[j] <- genre
      pop_film[j] <- data_pop$popularity[i]
      j <- j+1
    }
  }
}

data_genre_and_pop <- data.frame(genre=genre_film, popularity=pop_film)
```

```{r data_pop_max_by_genre}
pop_max <- c()
i <- 1
for (genre in genre_list) {
  pop_max[i] <- max((data %>%
                         select(genres, popularity) %>%
                         filter(grepl(genre, genres)))$popularity)
  i <- i+1
}

pop_max_by_genre <- data.frame(genre = genre_list, popularity = pop_max)
pop_max_by_genre <- pop_max_by_genre %>%
  arrange(desc(popularity))
```

```{r graph_popularity_by_genre1}
data_genre_and_pop1 <- data_genre_and_pop %>%
  filter(data_genre_and_pop$genre %in% pop_max_by_genre$genre[pop_max_by_genre$popularity > 500])

box_plot_pop1 <- ggplot(data = data_genre_and_pop1, aes(x = genre, y = popularity)) +
    geom_boxplot(fill = "orange", color = "black", size = 0.3) +  
    stat_summary(fun = "mean", geom = "point", shape = 20, size = 1.5, color = "brown4") +
    labs(x = "Genres", y = "Popularit√©", title = "Distribution de la popularit√© par genre de film (√† grande popularit√©)") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
plotly_plot1 <- ggplotly(box_plot_pop1, tooltip = c())
plotly_plot1
```

```{r graph_popularity_by_genre2}
data_genre_and_pop2 <- data_genre_and_pop %>%
  filter(data_genre_and_pop$genre %in% pop_max_by_genre$genre[(pop_max_by_genre$popularity < 500) & (pop_max_by_genre$popularity > 101)])

box_plot_pop2 <- ggplot(data = data_genre_and_pop2, aes(x = genre, y = popularity)) +
    geom_boxplot(fill = "orange", color = "black", size = 0.3) +  
    stat_summary(fun = "mean", geom = "point", shape = 20, size = 2, color = "brown4") +
    labs(x = "Genres", y = "Popularit√©", title = "Distribution de la popularit√© par genre de film (√† popularit√© moyenne)") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
plotly_plot2 <- ggplotly(box_plot_pop2, tooltip = c())
plotly_plot2
```

```{r graph_popularity_by_genre3}
data_genre_and_pop3 <- data_genre_and_pop %>%
  filter(data_genre_and_pop$genre %in% pop_max_by_genre$genre[pop_max_by_genre$popularity < 101])

box_plot_pop3 <- ggplot(data = data_genre_and_pop3, aes(x = genre, y = popularity)) +
    geom_boxplot(fill = "orange", color = "black", size = 0.3) +  
    stat_summary(fun = "mean", geom = "point", shape = 20, size = 2, color = "brown4") +
    labs(x = "Genres", y = "Popularit√©", title = "Distribution de la popularit√© par genre de film (√† faible popularit√©)") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
plotly_plot3 <- ggplotly(box_plot_pop3, tooltip = c())
plotly_plot3
```

**Analyse**
On constate que les genres les plus populaires sont les films d'action, d'aventure, d'animation, familiale, de science-fiction et de fantasy. N√©anmoins, certains genres un peu moins populaires comme les com√©dies et les drames comprennent quelques films √† tr√®s grand popularit√©, l√† o√π la popularit√© des films d'action, est moins importante, mais plus constante. Enfin, on remarque que les documentaires et les films √©trangers ont une popularit√© globalement tr√®s faible.

---

Une fois les genres les plus populaires d√©termin√©s, nous pouvons nous pencher sur les revenus g√©n√©r√©s et le budget demand√© pour la production de chaque genre et les comparer. Cela nous permettrait de voir quels sont les genres demandant le plus de budget ou g√©n√©rant le plus de revenus.

Pour cela, on peut tout d'abord d√©terminer le budget total demand√© et le revenu total g√©n√©r√© pour chaque genre, en calculant la somme du budget et du revenu g√©n√©r√© pour chaque film de chaque genre.

```{r budget_revenue_by_genre}
sum_revenue <- c()
sum_budget <- c()
mean_revenue <- c()
mean_budget <- c()
nb_films <- c()
i <- 1
for (genre in genre_list) {
  sum_revenue[i] <- sum((data %>%
                         select(genres, revenue) %>%
                         filter(grepl(genre, genres)))$revenue)
  sum_budget[i] <- sum((data %>%
                         select(genres, budget) %>%
                         filter(grepl(genre, genres)))$budget)
  nb_films[i] <- nrow((data %>%
                         select(genres, budget) %>%
                         filter(grepl(genre, genres))))
  mean_revenue[i] <- sum_revenue[i]/nb_films[i]
  mean_budget[i] <- sum_budget[i]/nb_films[i]
  i <- i+1
}

budg_rev_by_genre <- data.frame(genre = genre_list, budget = sum_budget, revenue = sum_revenue, nb_films = nb_films, mean_budget = mean_budget, mean_revenue = mean_revenue)
budg_rev_by_genre <- budg_rev_by_genre %>%
  arrange(desc(revenue))
```

```{r dodge_bar_plot_budget_revenue_total_by_genre}
genre_comp <- c()
budget_revenue <- c()
value <- c()
for (i in 1:21) {
  if ((budg_rev_by_genre$revenue[i] > 10000000000) & (budg_rev_by_genre$budget[i] > 10000000000)) {
    value[length(value)+1] <- budg_rev_by_genre$budget[i]
    value[length(value)+1] <- budg_rev_by_genre$revenue[i]
    genre_comp[length(genre_comp)+1] <- budg_rev_by_genre$genre[i]
    genre_comp[length(genre_comp)+1] <- budg_rev_by_genre$genre[i]
    budget_revenue[length(budget_revenue)+1] <- "Budget total"
    budget_revenue[length(budget_revenue)+1] <- "Revenu total"
  }
}

data_by_genre <- data.frame(genre_comp,budget_revenue,value)

ggplot(data_by_genre, aes(fill = budget_revenue, y = as.numeric(value), x = genre_comp)) + 
    geom_bar(position="dodge", stat="identity") +
    geom_text(aes(label = sprintf("%.0f", value / 1e9)), position = position_dodge(width=0.9) , vjust = -0.5,  size = 3) +
    scale_y_continuous(labels = function(x) sprintf("%.0f Mrd", x / 1e9)) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    labs(x = "Genre", y = "Budget/revenu total (en Mrd de $)", 
       title = "Comparaison budget/revenu total par genre",
       fill = "")
```
On distingue 5 genres qui se d√©marquent par le budget total demand√© et le revenu total g√©n√©r√© : Action, Adventure, Comedy, Drama et Thriller. N√©anmoins, ces valeurs peuvent √™tre biais√©es par le nombre de films produits dans chaque genre. On r√©alise donc un nouveau graphique permettant de comparer le budget moyen et le revenu moyen par genre (et donc pour un film).

```{r dodge_bar_plot_budget_revenue_mean_by_genre}
genre_comp <- c()
mean_budget_revenue <- c()
value <- c()
for (i in 1:21) {
  if ((budg_rev_by_genre$mean_revenue[i] > 50000000) & (budg_rev_by_genre$mean_budget[i] > 20000000)) {
    value[length(value)+1] <- budg_rev_by_genre$mean_budget[i]
    value[length(value)+1] <- budg_rev_by_genre$mean_revenue[i]
    genre_comp[length(genre_comp)+1] <- budg_rev_by_genre$genre[i]
    genre_comp[length(genre_comp)+1] <- budg_rev_by_genre$genre[i]
    mean_budget_revenue[length(mean_budget_revenue)+1] <- "Budget moyen"
    mean_budget_revenue[length(mean_budget_revenue)+1] <- "Revenu moyen"
  }
}
data_by_genre <- data.frame(genre_comp,mean_budget_revenue,value)

ggplot(data_by_genre, aes(fill = mean_budget_revenue, y = as.numeric(value), x = genre_comp)) + 
    geom_bar(position="dodge", stat="identity") +
    geom_text(aes(label = sprintf("%.0f", value / 1e6)), position = position_dodge(width=0.9) , vjust = -0.5,  size = 3) +
    scale_y_continuous(labels = function(x) sprintf("%.0f M", x / 1e6)) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
    labs(x = "Genre", y = "Budget/revenu moyen (en M de $)", 
       title = "Comparaison budget/revenu moyen par genre",
       fill = "")
```

**Analyse**

Ainsi, on remarque que certains genres pr√©dominants comme Adventure ou Action restent majoritaires, tandis que d'autres comme Drama, Comedy ou Thriller ont une moyenne bien inf√©rieure √† Action et Adventure. Par ailleurs, on distingue les genres Animation, Family, Fantasy et Science-Fiction dont les moyennes sont sup√©rieures ou proches de Adventure. On peut donc en d√©duire que les genres Drama, Comedy et Thriller poss√®dent une grande quantit√© de films produits, contrairement aux genres Animation, Family, Fantasy et Science-Fiction. On observe ainsi que les genres Action, Adventure, Animation, Family, Fantasy et Science-Fiction demandent un budget plus cons√©quent que l'on peut traduire par des besoins d'effets sp√©ciaux ou de post-production. Ces genres sont √©galement sont g√©n√©rant le plus de revenus en moyenne. On peut donc se demander si ces genres g√©n√©rant le plus de revenus sont √©galement les plus populaires ? En analysant le graphique "Distribution de la popularit√© par genre de film (√† grande popularit√©)", on remarque ainsi que ce sont effectivement les genres pr√©sents sur le graphique. N√©anmoins, la popularit√© des genres Animation et Family √©tant principalement port√©e par un seul film, de m√™me pour Comedy et Drama, on peut consid√©rer que la popularit√© du dataset d√©pend de plusieurs facteurs et qu'elle n'est pas (ou pas uniquement) li√©e au revenu g√©n√©r√© d'un film.

---

Ici, on va s'int√©resser √† la relation qui existe entre la note d'un film et le ou les acteurs du film. Quel est le lien entre les acteurs et la note ou la popularit√© du film ?

Cette analyse vise √† d√©terminer la relation entre les acteurs et la popularit√© ou la note attribu√©e √† un film. Nous cherchons √† savoir si la pr√©sence d'un acteur influence la note ou la popularit√© du film. La note du film est une variable quantitative continue, et l'acteur est une donn√©e qualitative nominale.
Pour √©tudier la distribution de la note ou de la popularit√© en fonction des acteurs, la visualisation la plus appropri√©e est un barplot (diagramme √† barres). Le barplot permet de comparer visuellement la note moyenne ou la popularit√© des films associ√©s √† diff√©rents acteurs, et d'√©valuer s'il existe des diff√©rences significatives en fonction des acteurs.

```{r lien film et acteur}
movies <- data
# S√©parer les noms des acteurs pour chaque film
movies_separated <- movies %>%
separate_rows(cast, sep = ", ")

# Extraire uniquement les noms de famille des acteurs
movies_separated <- movies_separated %>%
  mutate(cast = str_extract(cast, "\\b\\w+$"))

# Compter les occurrences de chaque acteur et filtrer
actor_counts <- movies_separated %>%
  count(cast) %>%
  arrange(desc(n))

# Choisir le seuil pour les acteurs les plus fr√©quents (par exemple, ceux qui apparaissent au moins 10 fois)
frequent_actors <- actor_counts %>%
  filter(n >= 10) %>%
  pull(cast)
# Filtrer les donn√©es pour ne garder que les acteurs fr√©quents
movies_filtered <- movies_separated %>%
  filter(cast %in% frequent_actors)

# Trouver le film avec la plus grande note pour chaque acteur
actor_best_movie <- movies_filtered %>%
  group_by(cast) %>%
  slice_max(order_by = vote_average, n = 1, with_ties = FALSE) %>%
  ungroup() %>%
  left_join(movies, by = c("cast", "vote_average", "title")) %>% # Pour r√©cup√©rer les titres des films originaux
  select(cast, vote_average, title) %>%
  distinct()

# Cr√©ation du barplot
plot_interactif_1 <- ggplot(actor_best_movie, aes(x = reorder(cast, vote_average), y = vote_average, fill = cast, text = paste("Films:", title))) +
geom_bar(stat = "identity") +
  scale_fill_viridis_d() +
  labs(title = "Relation entre les acteurs et les meilleures notes de leurs films",
       x = "Acteur",
       y = "Note moyenne") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  coord_flip()

# Conversion en graphique interactif avec plotly
plotly_plot <- ggplotly(plot_interactif_1, tooltip = "text")

# Affichage du graphique interactif
plotly_plot
```

**Analyse**
Certains films re√ßoivent une note moyenne largement sup√©rieure √† 5 en raison de la pr√©sence d'un acteur c√©l√®bre. Cela sugg√®re que l'acteur peut influencer la note attribu√©e √† un film. En effet, plus un acteur est connu, plus le film a de chances de conna√Ætre un succ√®s accru. Cette tendance peut s'expliquer par plusieurs facteurs.
Tout d'abord, l'attraction du public joue un r√¥le crucial. Les acteurs populaires ont souvent une base de fans fid√®les qui peuvent influencer positivement la popularit√© d'un film. Les fans sont enclins √† regarder et √† appr√©cier les films mettant en vedette leurs acteurs pr√©f√©r√©s, ce qui peut contribuer √† des notes plus √©lev√©es.
De plus, les films avec des acteurs c√©l√®bres b√©n√©ficient g√©n√©ralement d'une meilleure couverture m√©diatique et de campagnes marketing plus agressives. Cette visibilit√© accrue attire un public plus large et peut √©galement contribuer √† des notes plus √©lev√©es pour le film.
En conclusion, la pr√©sence d'acteurs c√©l√®bres semble jouer un r√¥le significatif dans la perception et la r√©ussite d'un film, influen√ßant √† la fois la note attribu√©e et la r√©ception par le public.


### Analyse des tendances temporelles

Analysons d√©sormais les diff√©rentes tendances temporelles.

Nous allons tout d'abord nous int√©resser √† l'√©volution du budget et des revenus des films au fil du temps. Nous nous attendons √† ce que plus on remonte le temps, et plus le budget et les revenus soient bas, ce qui correspondrait au d√©veloppement ces derni√®res ann√©es du cin√©ma. 

Pour cette question, un dashboard interactif a √©t√© cr√©√©. Il permet sur une premi√®re page √† l'utilisateur de choisir la plage d'ann√©es qu'il souhaite √©tudier, puis de consulter des statistiques sur le budget et le revenu. Deux diagrammes interactifs de type boxplot permettent de voir la distribution du budget et des revenus des films se situant dns la p√©riode choisie. 
Sur une seconde page, l'utilisateur peut visualiser l'√©volution du budget, des revenus et des b√©n√©fices en fonction du temps.
Pour tous les graphiques du dashboard (et ceux que nous pr√©sentons sur le rapport), nous faisons le choix d'√©carter les individus o√π le budget et les revenus sont √† 0$, car nous consid√©rons qu'il s'agit d'anomalies. 
De plus, il nous semble important de calculer les b√©n√©fices des films. Nous avons choisi pour cela de d√©duire des revenus le budget du film, pour obtenir √† peu pr√®s les b√©n√©fices. 
Enfin, comme nous souhaitons voir l'√©volution, nous avons d√©cider de grouper les films par ann√©e de production, puis de calculer soit la moyenne par ann√©e, soit la m√©diane. Ce choix de m√©trique s'effectue directement depuis le dashboard. L√† encore, le diagramme est interactif afin de donner de la libert√© √† l'utilisateur pour qu'il explore les donn√©es. 

Des screenshots des deux pages du dashboard ont √©t√© r√©alis√©s pour √™tre montr√©s dans ce rapport, mais nous d√©taillerons ensuite les diff√©rents graphiques en les rendant accessibles directement depuis ce rapport. L'utilisateur peut se rendre directement dans le dossier shiny pour manipuler le dashboard s'il le souhaite.

![Dashboard 1](data/dashboard_1.png)
![Dashboard 2](data/dashboard_2.png)

Regardons tout d'abord la distribution du budget et des revenus √† l'aide d'un boxplot.

```{r distribution_budget_revenu}
filtered_data <- data
filtered_data$year <- format(as.Date(filtered_data$release_date), "%Y")
filtered_data$budget <- ifelse(filtered_data$budget == 0, NA, filtered_data$budget)
filtered_data$revenue <- ifelse(filtered_data$revenue == 0, NA, filtered_data$revenue)


budget_ggplot <- ggplot(data = filtered_data, aes(y = budget/1e6, x = 1)) +
  geom_boxplot(fill = 'skyblue') +
  labs(title = "Distribution du budget", y = "Budget (en Millions de $)", x="") +
  theme_gray() +
  scale_y_continuous(labels = dollar_format(suffix = "M")) +
  stat_summary(fun = "mean", geom = "point", shape = 20, size = 2, color = "darkblue")

revenue_ggplot <- ggplot(data = filtered_data, aes(y = revenue/1e6, x=1)) +
  geom_boxplot(fill = 'skyblue') +
  labs(title = "Distribution des revenus", y = "Revenus (en Millions de $)", x="") +
  theme_gray() +
  scale_y_continuous(labels = dollar_format(suffix = "M")) +
  stat_summary(fun = "mean", geom = "point", shape = 20, size = 2, color = "darkblue")


budget_plotly <- ggplotly(budget_ggplot) %>% layout(xaxis = list(showticklabels = FALSE))
revenue_plotly <- ggplotly(revenue_ggplot) %>% layout(xaxis = list(showticklabels = FALSE))

budget_plotly
revenue_plotly

```

**Analyse**

Nous pouvons voir ici les distributions du budget et des revenus dans notre jeu de donn√©es.

On constate que la m√©diane du budget est de 23 Millions de dollars alors que celle des revenus est de presque 52 Millions de dollars. La moyenne (repr√©sent√©e par un point bleu sur les graphiques) s'√©l√®ve quant √† elle √† 117 Millions de dollars pour les revenus et 37 Millions pour le budget. 

On s'attend donc √† ce que la courbe d'√©volution des revenus sur le prochain graphique soit plus √©lev√©e que celle du budget. 
Nous allons ici afficher le graphique o√π les films sont regroup√©s par ann√©e, et o√π pour chaque ann√©e, la moyenne du budget, des revenus et des b√©n√©fices est affich√©e.
Le graphique suivant est aussi interacif. Il est donc possible de zoomer sur certaines parties, et d'afficher ou non les diff√©rentes courbes. 

Comme il s'agit de l'√©tude d'une √©volution avec des donn√©es temporelles, nous choisissons de r√©aliser un line graph.


```{r evolution_budget_revenu}

filtered_data <- data
filtered_data$year <- format(as.Date(filtered_data$release_date), "%Y")
filtered_data$benefices <- ifelse(
  filtered_data$revenue == 0 | filtered_data$budget == 0,
  NA,
  filtered_data$revenue - filtered_data$budget
)
filtered_data$revenue <- ifelse(filtered_data$revenue == 0, NA, filtered_data$revenue)
filtered_data$budget <- ifelse(filtered_data$budget == 0, NA, filtered_data$budget)

modified_data <- filtered_data %>%
  group_by(year) %>%
  summarise(
    modified_budget = mean(budget, na.rm = TRUE),
    modified_revenue = mean(revenue, na.rm = TRUE),
    modified_benefices = mean(benefices, na.rm = TRUE)
  )

modified_data$year <- as.numeric(modified_data$year)

p <- ggplot(data = modified_data, aes(x = year)) +
  geom_line(aes(y = modified_budget, color = 'Budget')) +
  geom_line(aes(y = modified_revenue, color = 'Revenus')) +
  geom_line(aes(y = modified_benefices, color = 'B√©n√©fices')) +
  scale_color_manual(name="", values=c("Budget"="red", "Revenus"="blue", "B√©n√©fices"="darkgreen")) +
  scale_y_continuous(labels = function(x) sprintf("%.0f M", x / 1e6)) +
  labs(title = "√âvolution des b√©n√©fices, du budget et des revenus des films dans le temps",
       x = "Date (par ann√©e)",
       y = "Montant moyen (en M de $)") +
  theme_gray()

ggplotly(p) %>%
  layout(legend = list(
    orientation = 'h',
    x = 0.5,
    y = -0.2,
    xanchor = 'center',
    yanchor = 'top'
  ))

```


**Analyse**

Ce graphique nous donne plusieurs informations int√©ressantes.

Tout d'abord, on constate bien que le budget moyen est nettement inf√©rieur aux revenus et b√©n√©fices moyens, ce qui est en accord avec ce qui a √©t√© dit pr√©c√©demment. Ces disparit√©s soulignent une belle rentabilit√© de l'industrie cin√©matographique. 

Ensuite, on rel√®ve, que ce soit pour le budget, les revenus ou les b√©n√©fices, que globalement ils augmentent au fil des ann√©es. Cela s'explique en partie par le d√©veloppement au cours du temps des diff√©rentes technologies au service du cin√©ma, qui permettent de r√©aliser des films plus facilement. Par exemple, l'arriv√©e des effets sp√©ciaux dans le cin√©ma comme la technique des "images de synth√®se 3D" pr√©sente dans Jurassic Park r√©alis√© en 1992, permet de cr√©er des films de plus en plus impressionnants, attirant toujours plus de monde. Cependant, toute cette technologie a un co√ªt, ce qui explique l'augmentation du budget ces derni√®res ann√©es. En outre, gr√¢ce √† la mondialisation, on assite √† une expansion des march√©s, ce qui permet de distribuer les films au niveau mondial et ainsi d'augmenter les revenus globaux. 

Enfin, on constate √©galement sur ce graphique des fluctuations importantes √† certaines dates. On peut √©mettre l'hypoth√®se que cela pourrait √™tre d√ª aux tendances du march√© ou √† la situation √©conomique, cependant nous pensons aussi qu'il pourrait s'agir d'annn√©es o√π un film "blockbuster" est sorti, jouant fortement sur le calcul de la moyenne. Cela est d'autant plus vrai pour les films d'avant 1980, peu repr√©sent√©s dans le dataset. Pour v√©rifier notre hypoh√®se, nous allons donc afficher les pics observ√©s en 1927, 1937, 1939 et 1942.


```{r infos_budget_revenu}

selected_films <- filtered_data %>%
  filter(format(as.Date(release_date), "%Y") %in% c("1927", "1937", "1939", "1942")) %>%
  drop_na(release_date, title, director, revenue, budget, benefices) %>%
  select(release_date, title, director, revenue, budget, benefices) %>%
  arrange(release_date)

selected_films %>%
  mutate(
    release_date = format(release_date, "%Y-%m-%d"),
    revenue = scales::dollar(revenue),
    budget = scales::dollar(budget),
    benefices = scales::dollar(benefices)
  ) %>%
  kable("html", caption = "D√©tails des ann√©es ayant des donn√©es sortant du lot") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), 
                full_width = F, 
                position = "center")

```


Tout d'abord, int√©ressons nous √† l'ann√©e 1927. Le film recens√© est Metropolis de Fritz Lang. Lors de sa sortie, il s'agissait du film le plus cher de l'histoire du cin√©ma, ce qui explique le pic de budget de 1927. Cependant, il s'av√®re que ce film a √©t√© un v√©ritable √©chec critique et commercial, ce qui explique son gros d√©ficit. Il est √† noter tout de m√™me que Metropolis a √©t√© am√©lior√© et restaur√© plusieurs fois, et c'est pour cela qu'il est tr√®s connu.

Arr√™tons-nous d√©sormais sur l'ann√©e 1937. Cette derni√®re est synonyme de la sortie du film "Blanche Neige est les 7 nains" de David Hand. C'est le premier long-m√©trage d'animation des studios Disney. Il regorge d'innovations techniques et artistiques pour l'√©poque, ce qui le rend mondialement connu. Il continu de g√©n√©rer d'importants revenus encore aujourd'hui, ce qui explique le pic important pr√©sent sur le graphique.

En 1939, le film am√©ricain "Autant en emporte le vent" de Victor Fleming sort. Il remporte 8 Oscars en 1940, ce qui le propulse au devant de la sc√®ne. Le performance des acteurs du film lui permet de devir un incontournable du 7√®me art, g√©n√©rant ainsi des revenus √©lev√©s. 

Pour finir, en 1942, le film "Bambi" de David Hand est responsable du pic des b√©n√©fices observ√©s. Il s'agit de nouveau d'un long-m√©trage des studios Disney, qui se distingue cette fois-ci par un style graphique exceptionnel pour l'√©poque. Les sc√®nes sont extr√™mement d√©taill√©es et color√©es, rendant les d√©cors et les personnages tr√®s r√©alistes. "Bambi" est d'ailleurs propouls√© en 2008 √† la 3√®me place du classement "AFI's 10 Top 10". Il est aujourd'hui encore tr√®s visionn√©. 

On peut donc confirmer que les pics observ√©s correspondent √† la sortie de films particul√®rement appr√©ci√©s (ou inverse), en √©mettant tout de m√™me une r√©serve due √† la quantit√© de donn√©es faibles pour les ann√©es ant√©rieures √† 1980. N√©anmoins, si l'on analyse tr√®s rapidement d'autres fluctuations importantes plus r√©centes, on se rend compte que les blockbusters influent fortement le calcul : 

- 1965 : "The Sound of Music" de Robert Wise

- 1977 : "Star Wars" de	George Lucas

- 1990 : "Pretty Woman" de Garry Marshall 

- 2012 : "The Avengers" de Joss Whedon, "The Dark Knight Rises" de Christopher Nolan et "The Hobbit" de	Peter Jackson

- 2016 : 	"Captain America" de Anthony Russo et "The Secret Life of Pets"	de Chris Renaud


Nous avons ainsi pu analyser dans cette partie les tendances temporelles de l'√©volution du budget et des revenus des films.


---

Maintenant que nous avons vu les tendances temporelles du budget et des revenus, nous pouvons nous demander quel film a g√©n√©r√© le plus de revenus par pays de production, et quel film a demand√© le plus de budget. L'id√©e ici est de voir si les pays r√©put√©s pour avoir de gros studios de production sont vraiment ceux cr√©ant des "blockbuster" ou non. Nous nous attendons √† ce que ce soit globalement le cas. Aussi, nous aimerions v√©rifier si les pays qui ont les films avec les plus gros budget sont les m√™mes que ceux qui ont les plus gros revenus.

Comme beaucoup de pays sont recens√©s dans notre dataset, nous avons choisi de cr√©er deux "map" interactives (une pour les revenus, une pour le budget), afin de laisser l'utilisateur zoomer √† sa guise sur la carte. Pour aider √† la lecture, nous ajoutons une √©chelle de couleur pour les deux cartes selon les revenus et les budgets.

Un pr√©traitement assez important est n√©cessaire avant de cr√©er la carte. En effet, nous commen√ßons par nettoyer la liste des pays de production (un film peut avoir plusieurs pays de production), puis nous gardons pour chaque pays seulement le film qui a g√©n√©r√© le plus de revenus (ou budget pour la 2√®me map). Nous supprimons les films qui ont des revenus (ou un budget) de 0$ car nous les consid√©rons comme des anomalies. Ensuite, nous effectuons une jointure avec un autre dataset afin de r√©cup√©rer les coordonn√©es g√©ographiques et d'obtenir la correspondance des pays avec les codes pays "2 lettres" (la table est jointe sur ce code). Pour finir, nous pouvons cr√©er la carte avec la librairie leaflet, en veillant √† r√©aliser une √©chelle de couleur et √† la pr√©ciser en l√©gende. Chaque rond poss√®de un l√©ger contour noir pour bien distinguer les points. Nous avons jug√© l'√©chelle de couleur plus pertinente que l'√©chelle de taille, car cela permet de ne pas surchager le graphique. 


```{r film_revenus_par_pays}
movies_data <- data

country_coords <- read.csv("data/countries_codes_and_coordinates.csv")
colnames(country_coords) <-
  c("country", "alpha_2_code", "alpha_3_code", "numeric_code", "lat", "lon")
country_coords$alpha_2_code <- trimws(country_coords$alpha_2_code)

clean_countries <- function(countries) {
  cleaned <- gsub("[^A-Z]", "", countries)
  return(cleaned)
}

movies_data$production_countries <-
  gsub("\\[|\\]", "", movies_data$production_countries)
movies_data <- movies_data %>%
  separate_rows(production_countries, sep = ", ") %>%
  filter(production_countries != "") %>%
  mutate(production_countries = clean_countries(production_countries))

max_revenue_per_country <- movies_data %>%
  group_by(production_countries) %>%
  slice_max(order_by = revenue, n = 1) %>%
  filter(revenue != 0) %>%
  ungroup()

max_revenue_per_country <- max_revenue_per_country %>%
  left_join(country_coords, by = c("production_countries" = "alpha_2_code")) %>%
  select(title, revenue, production_countries, release_date, country, lat, lon)

title_box <- tags$div(class = "info legend",
                      tags$h4("Films ayant g√©n√©r√© les plus gros revenus par pays"),)

palette <- colorNumeric(palette = "YlOrRd", domain = max_revenue_per_country$revenue)
leaflet(max_revenue_per_country) %>%
  addTiles() %>%
  addCircleMarkers(
    ~ lon,
    ~ lat,
    radius = 6,
    stroke = TRUE,
    color = "black",
    weight = 1,
    opacity = 1,
    fillColor = ~ palette(revenue),
    fillOpacity = 1,
    popup = ~ paste(
      "<strong>Titre :</strong>",
      title,
      "<br><strong>Revenus :</strong> $",
      scales::comma(revenue),
      "<br><strong>Date :</strong>",
      release_date,
      "<br><strong>Pays :</strong>",
      country
    ),
    label = ~ paste(country)
  ) %>%
  addLegend(
    "bottomright",
    pal = palette,
    values = ~ revenue,
    title = "Revenus",
    labFormat = labelFormat(prefix = "$"),
    opacity = 1
  ) %>%
  addControl(position = "topright",
             html = title_box)

```

---

```{r film_budget_par_pays}

max_budget_per_country <- movies_data %>%
  group_by(production_countries) %>%
  slice_max(order_by = budget, n = 1) %>%
  filter(budget != 0) %>%
  ungroup()

max_budget_per_country <- max_budget_per_country %>%
  left_join(country_coords, by = c("production_countries" = "alpha_2_code")) %>%
  select(title, budget, production_countries, country, lat, lon, release_date)

title_box <- tags$div(class = "info legend",
                      tags$h4("Films ayant n√©cessit√© le plus gros budget par pays"),)

palette <-
  colorNumeric(palette = "YlOrRd", domain = max_budget_per_country$budget)
leaflet(max_budget_per_country) %>%
  addTiles() %>%
  addCircleMarkers(
    ~ lon,
    ~ lat,
    radius = 6,
    stroke = TRUE,
    color = "black",
    weight = 1,
    opacity = 1,
    fillColor = ~ palette(budget),
    fillOpacity = 1,
    popup = ~ paste(
      "<strong>Titre :</strong>",
      title,
      "<br><strong>Budget :</strong> $",
      scales::comma(budget),
      "<br><strong>Date :</strong>",
      release_date,
      "<br><strong>Pays :</strong>",
      country
    ),
    label = ~ paste(country)
  ) %>%
  addLegend(
    "bottomright",
    pal = palette,
    values = ~ budget,
    title = "Budget",
    labFormat = labelFormat(prefix = "$"),
    opacity = 1
  ) %>%
  addControl(position = "topright",
             html = title_box)
```


**Analyse**

Si l'on regarde la carte des revenus, on constate que les Etats-Unis, le Royaume Uni, le Japon, la Nouvelle-Z√©lande et la Chine sortent particuli√®rement du lot avec leur film √† plus haut revenus.

La pr√©sence de ces pays n'est pas √©tonnante, puisque de grands studios de production sont pr√©sents dans ces derniers, comme WingNut Films (NZ), Bray (UK), Hengdian World Studios (Chine), 20th Century Fox (US). Cette visualisation est ainsi en accord avec ce que l'on pensait : les pays r√©put√©s pour avoir de gros studios de production sont ceux cr√©ant des ‚Äúblockbuster‚Äù. 

Si l'on s'int√©resse maintenant √† la carte des budgets, on constate que les diff√©rences sont moins nettes que sur la carte pr√©c√©dente. Cependant, on peut observer quelques similarit√©s avec une carte de d√©veloppement des pays. En effet, l'Europe de l'Ouest, les Etats-Unis, le Canada, le Japon, l'Australie et la Nouvelle Z√©lande ont des budgets maximums √©lev√©s, et sont aussi des pays tr√®s d√©velopp√©s. Au contraire, le Nig√©ria, le Liban, le Kazakhstan ou encore les pays d'Am√©rique du Sud, ont des budgets maximums moins √©lev√©s, et sont √©galement des pays moins d√©velopp√©s. On peut ainsi penser que l'indice de d√©veloppement des pays peut repr√©senter un facteur jouant dans le montant maximum des budgets attribu√©s aux films. Certains pays d√©rogent √† cette association, comme c'est le cas de l'Inde. Cependant, ce pays est reconnu pour dans le cin√©ma pour "Bollywood" et son industrie s'exportant dans le monde entier, ce qui peut expliquer le budget √©lev√©.

Aussi, nous voulions v√©rifier que les pays avec les revenus √©lev√©s sont les m√™mes que ceux avec ayant un budget √©lev√©. Apr√®s comparaison des deux cartes, il est difficile de conclure sur cette interrogation. Nous r√©alisons donc un graphique suppl√©mentaire pour √©tudier si il y a une corr√©lation entre ces deux points. Pour cela, nous faisons un scatter plot interactif apr√®s avoir cr√©√© un nouveau dataset regroupant pour chaque pays le budget et les revenus maximums.  

Pour pousser l'√©tude un peu plus loin, nous associons ce nouveau dataset √† un autre qui regroupe l'indicateur de d√©veloppement humain en 2017 par pays. Nous allons encoder l'IDH par la couleur sur le graphique suivant. Nous pourrons ainsi confirmer les propos ci-dessus.  

```{r film_correlation_budget_revenus_max}
hdi <- read.csv("data/HDI.csv")
hdi <- hdi %>%
  rename(country = Country, indicator_hdi = X2017) %>%
  select(country, indicator_hdi)

merged_budget_revenue <- merge(max_budget_per_country, max_revenue_per_country, by = c("country"))
merged_budget_revenue <- left_join(merged_budget_revenue, hdi, by = "country")
merged_budget_revenue$text <- paste("Pays :", merged_budget_revenue$country, "<br>Budget :", round(merged_budget_revenue$budget)/1e6, "M", "<br>Revenus :", round(merged_budget_revenue$revenue/1e6), "M", "<br>IDH :", merged_budget_revenue$indicator_hdi)

ggplotly(ggplot(data = merged_budget_revenue, aes(x = revenue/1e6, y = budget/1e6, text = text, color = indicator_hdi)) +
  geom_point() +
  labs(title = "Corr√©lation entre le Budget et les Revenus par pays",
       y = "Budget (en Millions $)",
       x = "Revenus (en Millions $)") +
  theme_minimal() +
  theme_gray() + 
  scale_color_gradient(low = "yellow", high = "red",name = "IDH"),
  tooltip = "text")

```

Pour ce qui est de l'IDH, on constate bien que plus le budget est √©lev√© et plus l'IDH a tendance √† √™tre haut, ce qui correspond √† ce que l'on avait identifi√© avant.  

Gr√¢ce √† ce graphique, on constate qu'il semble bel et bien y avoir un lien, et que les pays avec les revenus √©lev√©s sont en g√©n√©ral les m√™mes que ceux avec ayant un budget √©lev√©. M√™me s'il ne s'agit pas d'une regression lin√©aire franche, on observe quand m√™me que les pays avec un film ayant g√©n√©r√© beaucoup de revenus, sont aussi les pays o√π un film s'est vu octroyer un budget important. 

Ce type de visualisation nous a permis d'effectuer une comparaison plus simplement qu'en regardant les deux cartes, le scatter plot est donc concluant dans notre cas. Il serait int√©ressant d'√©galement r√©cup√©rer d'autres indicateurs que l'IDH pour voir si d'autres √©l√©ments entrent en jeu. Par exemple, nous pouvons penser √† la beaut√© ou le c√¥t√© atypique des paysages des diff√©rents pays. En effet, le choix des d√©cors naturels importe tr√®s certainement lorsque l'on veut choisir un pays de production. Cela d√©pend √©galement du type de film r√©alis√©. Peut √™tre que pour certains films, c'est plus le d√©veloppement technologique de la ville qui va entrer en jeu. La beaut√© de tel ou tel paysage √©tant somme toute assez subjective, il est difficile de cr√©er un r√©el indicateur pour faire une √©tude sur ce point. 

Dans cette partie, nous avons pu voir quel film a g√©n√©r√© le plus de revenus par pays de production, et quel film a demand√© le plus de budget. Nous avons montr√© que les pays r√©put√©s pour avoir de gros studios de production sont ceux cr√©ant des "blockbuster"et que les pays qui ont les films avec les plus gros budget sont globalement les m√™mes que ceux qui ont les plus gros revenus.



---

Nous examinons l'√©volution de la dur√©e des films au fil du temps dans le but de d√©terminer si elle pr√©sente une tendance croissante ou d√©croissante. √âtant donn√© que la date de sortie et la dur√©e des films sont toutes deux des variables quantitatives continues, et que notre objectif est d'√©tudier une √©volution, l'utilisation du graphique en ligne semble √™tre une approche pertinente pour repr√©senter ces donn√©es.

```{r}
movies <- data
movies$release_date <- as.Date(data$release_date)
movies$year <- format(movies$release_date, "%Y")
year <- movies$year
```

Les donn√©es contenant certaines fois des valeurs manquantes, il est judicieux d'utiliser la dur√©e moyenne des films pour avoir un meilleur graphique.

```{r Calcul de la dur√©e moyenne des films par ann√©e}
average_runtime_by_year <- movies %>%
  group_by(year) %>%
  summarise(average_runtime = mean(runtime, na.rm = TRUE))
average_runtime_by_year <- average_runtime_by_year %>%
  arrange(as.numeric(year))
```

```{r graphique de la dur√©e moyenne des films par ann√©e}
ggplot(average_runtime_by_year, aes(x = as.numeric(year), y = average_runtime)) +
  geom_point()+
  geom_line(stat="identity", color="darkblue")+
  geom_smooth(method = "lm", se = FALSE, color = "blue", linetype = "dashed") +
  labs(x = "Ann√©e ", y = "Dur√©e moyenne des films (en minutes)",title="√âvolution de la dur√©e dans le temps") +
  theme_minimal() +
  theme_gray()
```

**Analyse**

Le graphique obtenu r√©v√®le une tendance potentielle dans l'√©volution de la dur√©e moyenne des films, qu'elle soit croissante ou d√©croissante. Avant 1920, la dur√©e moyenne des films semble avoir √©t√© plus √©lev√©e par rapport aux autres ann√©es. Cependant, √† partir de l'an 2000, la dur√©e moyenne semble se stabiliser autour de 110 minutes.
Des anomalies dans le graphique peuvent √™tre observ√©es, ce qui peut √™tre attribu√© √† la pr√©sence de valeurs manquantes dans les donn√©es. De m√™me, on remarque des pics sur ce graphique qui semblent influencer la croissance ou la d√©croissance de la courbe d'√©volution. Ces pics pourraient-ils r√©sulter de donn√©es aberrantes ou de valeurs extr√™mes ?
Quant √† la d√©croissance de la dur√©e moyenne des films dans le temps, montr√©e par la courbe de tendance en pointill√©s, plusieurs facteurs peuvent √™tre en jeu. Il est possible que les pr√©f√©rences du public aient √©volu√©, privil√©giant des films plus courts. Cependant, il est √©galement envisageable que les films contemporains soient structur√©s diff√©remment, peut-√™tre moins d√©taill√©s, ce qui entra√Ænerait une r√©duction de leur dur√©e moyenne.


Pour analyser la distribution de la dur√©e des films dans le temps, nous utiliserons un boxplot. Le calcul de la dur√©e moyenne des films n'est pas n√©cessaire pour ce graphique.

```{r convertir release_date en date}
movies$release_date <- as.Date(movies$release_date)
movies$year <- format(movies$release_date, "%Y")
year <- movies$year
```

```{r Cr√©ation du graphique boxplot interactif}
intervalles <- seq(1900, 2020, by = 5)
plot_interactif_1 <- ggplot(data = data, aes(x = (cut(as.numeric(year), breaks = intervalles)), y = runtime)) +
  geom_boxplot(fill = "skyblue", color = "black", size = 0.3) +  
  labs(x = "Ann√©es (Tranche de 5 ans)", y = "Dur√©e du film (en minutes)", title = "Distribution de la dur√©e des films par tranche de 5 ans") +
  scale_y_continuous(labels = function(x) sprintf("%.1f", x)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
plotly_plot <- ggplotly(plot_interactif_1, tooltip = c())
plotly_plot
```

**Analyse**

Le graphique obtenu offre une vision claire de l'√©volution de la dur√©e des films de 1900 √† 2020, mettant en √©vidence une tendance d√©croissante au fil du temps, confirm√©e √† la fois par la m√©diane et la distribution des valeurs. Cependant, il est important de noter que le graphique montre √©galement des films avec une dur√©e de 0 minutes, ce qui est peu probable et pourrait √™tre attribu√© √† la pr√©sence de valeurs manquantes dans le jeu de donn√©es. De plus, des valeurs extr√™mes au-dessus du troisi√®me quartile (Q3) et en dessous du premier quartile (Q1) sugg√®rent la pr√©sence potentielle de donn√©es aberrantes ou de films qui sortent de la norme. Enfin, il est int√©ressant de noter que certains films ont une dur√©e d'un peu plus de 14 minutes. Il convient de se demander s'il s'agit r√©ellement de longs m√©trages ou de courts m√©trages.

Apr√®s s'etre interess√© √† l'evolution de la dur√©e des films dans le temps et aux autres facteurs de tendance temporelle du film , on va s'int√©resser √† la relation qui existe entre le budget et la dur√©e d'un film.

Le but de cette analyse est de d√©terminer la relation entre le budget d'un film et sa dur√©e. Plus pr√©cis√©ment, nous voulons savoir si un film dure plus longtemps parce que son budget est important, si un film dure moins longtemps parce que son budget est limit√©, ou si la dur√©e d'un film est ind√©pendante de son budget.

Pour √©tudier la relation entre ces deux variables quantitatives continues, la visualisation la plus appropri√©e est le scatter plot (diagramme de dispersion). Le scatter plot permet de visualiser la corr√©lation entre le budget(donn√©e quantitative continue) et la dur√©e des films(donn√©e quantitative continue), et d'identifier des tendances ou des anomalies dans les donn√©es.


```{r relation entre le budget et la dur√©e dun film }
movies <- data
# Cr√©ation de la visualisation avec ggplot2
plot_interactif_1 <- ggplot(movies, aes(x = budget, y = runtime)) +
  geom_point(aes(color = budget, size = budget), alpha = 0.7) +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(title = "Relation entre le budget et la dur√©e des films",
       x = "Budget (millions de $)",
       y = "Dur√©e (minutes)",
       color = "Budget (millions de $)",
       size = "Budget (millions de $)") +
  theme_minimal()

# Conversion du plot ggplot en plotly
plotly_plot <- ggplotly(plot_interactif_1, tooltip = c("budget", "runtime"))
plotly_plot
```
**Analyse**

Le graphique obtenu montre qu'il existe une corr√©lation positive entre le budget et la dur√©e d'un film car la dur√©e d'un film augmente proportionnellement avec son budget. Aussi, certains films √† faible budget sont des films dont la dur√©e est grande par rapport aux autres, est-ce pour dire que les films √† faible budget ont une dur√©e sup√©rieure √† un film √† grand budget ? Cette dif√©rence de dur√©e est-elle due au fait que les films ne sont pas du m√™me genre ou est-ce du √† des contraintes cin√©matographiques ? Cependant, on remarque que certains films ont un budget de 0$ et une dur√©e de 0 minutes ce qui n'est pas normal.


```{r filtrage des donn√©es}
#filtrons les donn√©es de sorte √† ne plus avoir de film avec un budget de 0$
movies_filtered <- movies %>%
  filter(budget > 0, runtime > 0, is.finite(budget), is.finite(runtime))
# Cr√©ation de la visualisation avec ggplot2
plot_interactif_1 <- ggplot(movies_filtered, aes(x = budget, y = runtime)) +
  geom_point(aes(color = budget, size = budget), alpha = 0.7) +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(title = "Relation entre le budget et la dur√©e des films",
       x = "Budget (millions de $)",
       y = "Dur√©e (minutes)",
       color = "Budget (millions de $)",
       size = "Budget (millions de $)") +
  theme_minimal()

# Conversion du plot ggplot en plotly
plotly_plot <- ggplotly(plot_interactif_1, tooltip = c("budget", "runtime"))
plotly_plot
```

V√©rifions si la dur√©e d'un film varie en fonction du genre 
Pour cela, cr√©ons un diagramme en bar.

```{r dur√©e des films en fonction du genre}
# Extraire les genres et la dur√©e des films
genres_0 <- movies %>% select(genres, runtime)

# Initialiser une liste pour stocker les genres modifi√©s
genres <- list()

# Parcourir chaque ligne pour extraire et corriger les genres
for (i in 1:nrow(genres_0)) {
  # V√©rifier si la cellule genres n'est pas vide ou NA
  if (!is.na(genres_0$genres[i]) && genres_0$genres[i] != "") {
    genres_split <- unlist(str_split(genres_0$genres[i], ' '))
if ("Science" %in% genres_split) {
      genres_split <- genres_split[(genres_split != "Science") & (genres_split != "Fiction")]
      genres_split[length(genres_split) + 1] <- "Science Fiction"
    }
    genres[[i]] <- genres_split
  } else {
    genres[[i]] <- NULL
  }
}

# Ajouter les genres modifi√©s √† un nouveau dataframe
movies_genres <- data.frame(matrix(ncol = 2, nrow = 0))
colnames(movies_genres) <- c("genre", "runtime")

for (i in 1:length(genres)) {
  if (!is.null(genres[[i]]) && length(genres[[i]]) > 0) {
    for (genre in genres[[i]]) {
      movies_genres <- rbind(movies_genres, data.frame(genre = genre, runtime = genres_0$runtime[i]))
    }
  }
}

# Calculer la dur√©e moyenne des films par genre
avg_duration <- movies_genres %>%
  group_by(genre) %>%
  summarise(avg_runtime = mean(runtime, na.rm = TRUE)) %>%
  filter(!is.na(genre))

# Cr√©er le bar plot
ggplot(avg_duration, aes(x = genre, y = avg_runtime, fill = genre)) +
  geom_bar(stat = "identity") +
labs(title = "Dur√©e moyenne des films par genre",
       x = "Genre",
       y = "Dur√©e moyenne (en minutes)",
       fill = "Genre") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


**Analyse**
Le graphique montre comment la dur√©e moyenne d'un film varie en fonction de son genre. D'apr√®s cette visualisation, il existe une corr√©lation positive entre le budget d'un film et sa dur√©e : les films avec un budget plus √©lev√© tendent √† avoir une dur√©e plus longue. Cependant, certains genres de films, tels que les films historiques, d'action et drame, pr√©sentent une dur√©e moyenne plus √©lev√©e malgr√© des budgets souvent modestes.
On peut donc conclure que bien que le budget influence significativement la dur√©e d'un film, d'autres facteurs comme le genre jouent √©galement un r√¥le important dans la d√©termination de la dur√©e d'un film.

---

On va maintenant s'int√©resser √† la  diff√©rence significative de la dur√©e des films entre diff√©rents pays ?

On cherche √† √©tudier les diff√©rences significatives dans la dur√©e des films entre diff√©rents pays. L'objectif est de d√©terminer si la dur√©e des films dans certains pays est significativement sup√©rieure ou inf√©rieure par rapport √† d'autres. Ces diff√©rences pourraient √™tre li√©es √† diverses contraintes, telles que les lois cin√©matographiques sp√©cifiques √† chaque pays, ou √† des probl√®mes budg√©taires.

Pour √©tudier et comparer la dur√©e des films (donn√©e quantitative continue) entre diff√©rents pays (donn√©e qualitative nominale), nous utiliserons un boxplot. Le boxplot est un outil graphique efficace pour visualiser la distribution des dur√©es de films et identifier les diff√©rences significatives entre les pays.

```{r diff√©rence de la dur√©e des films dans diff√©rents pays}
# Fonction pour nettoyer les codes de pays en ne conservant que les lettres majuscules
clean_countries <- function(countries) {
  cleaned <- gsub("[^A-Z]", "", countries)
  return(cleaned)
}

# S√©parer les pays de production en lignes distinctes
movies <- movies %>%
  separate_rows(production_countries, sep = ", ") %>%
  filter(production_countries != "")

# Appliquer la fonction de nettoyage aux codes de pays
movies$production_countries <- sapply(movies$production_countries, clean_countries)

# Filtrer √† nouveau pour s'assurer qu'il n'y a pas de valeurs vides
movies <- movies %>%
  filter(production_countries != "")

# Filtrer les pays qui produisent un nombre significatif de films (au moins 10 films)
country_counts <- movies %>%
  group_by(production_countries) %>%
  summarise(count = n(), avg_runtime = mean(runtime, na.rm = TRUE)) %>%
  filter(count >= 10)

# Cr√©er le barplot pour la dur√©e moyenne des films par pays
ggplot(country_counts, aes(x = reorder(production_countries, -avg_runtime), y = avg_runtime, fill = production_countries)) +
  geom_bar(stat = "identity") +
  labs(title = "Dur√©e moyenne des films par pays",
       x = "Pays (Code ISO)",
       y = "Dur√©e moyenne (en minutes)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



# Filtrer les films pour ne conserver que ceux des pays ayant produit au moins 10 films
movies_filtered <- movies %>%
  filter(production_countries %in% country_counts$production_countries)

# Cr√©er le boxplot pour la distribution des dur√©es des films par pays
plot_interactif_1 <- ggplot(movies_filtered, aes(x = reorder(production_countries, -runtime), y = runtime, fill = production_countries)) +
  geom_boxplot() +
  labs(title = "Distribution des dur√©es des films par pays",
       x = "Pays (Code ISO)",
       y = "Dur√©e des films (en minutes)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Convertir le graphique ggplot en graphique interactif avec plotly
plotly_plot <- ggplotly(plot_interactif_1, tooltip = c())

# Afficher le graphique interactif
plotly_plot
```
Le graphique obtenu montre des diff√©rences significatives dans la dur√©e des films entre diff√©rents pays. Certains pays ont des films dont la dur√©e est notablement sup√©rieure ou inf√©rieure par rapport √† d'autres. Plusieurs facteurs peuvent expliquer ces diff√©rences :

- Censure et coupures : Dans certains pays, des sc√®nes peuvent √™tre coup√©es ou censur√©es pour des raisons culturelles ou religieuses, ce qui r√©duit ainsi la dur√©e des films.

- Adaptation culturelle : Les films peuvent √™tre modifi√©s pour mieux correspondre aux pr√©f√©rences culturelles et aux attentes du public local. Cela peut inclure la suppression de sc√®nes jug√©es peu pertinentes ou inappropri√©es.

- Motivations commerciales : Certains distributeurs locaux peuvent d√©cider de modifier la dur√©e des films pour des raisons commerciales, telles que l'adaptation aux cr√©neaux horaires de diffusion ou pour maximiser l'audience.

Ces facteurs montrent l'importance de l'adaptation des films aux contextes locaux et aux attentes du march√©.

Par ailleurs, le boxplot r√©v√®le que certains pays produisent des films d'une dur√©e de 0 minute. Cela est probablement d√ª √† des donn√©es manquantes ou incorrectes dans le jeu de donn√©es.

En conclusion, les diff√©rences observ√©es dans la dur√©e des films entre diff√©rents pays soulignent l'impact des contextes culturels, r√©glementaires et commerciaux sur la production cin√©matographique.

---

Dans une seconde partie, nous allons chercher √† conna√Ætre l‚Äô√©volution de la popularit√© des films en fonction des ann√©es, car comprendre cette √©volution au fil des ann√©es peut fournir des informations pr√©cieuses sur les tendances de consommation de m√©dias, les pr√©f√©rences du public et les changements culturels.

Attente : On s‚Äôimagine que de nos jours, les films sont plus populaires compar√©s aux ann√©es 1900.

Nous avons utilis√© un geom_line() car nous voulons suivre l'√©volution de cette popularit√© au fil des ann√©es. Les variables utilis√©es, telles que la popularit√© et la date de sortie, sont des variables quantitatives continues. 
Tout d‚Äôabord nous avons effectu√© un premier pr√©traitement qui consistait √† convertir la variable release_date en donn√©es de type Date puis d‚Äôen extraire l‚Äôann√©e. Ensuite, calculer la popularit√© moyenne des films sur tous les ans. Enfin, construire un graphique avec la librairie ggplot2.

```{r}
movies_data <- data
movies_data$release_date <- as.Date(movies_data$release_date)
movies_data$year <- format(movies_data$release_date, "%Y")
year <- movies_data$year

average_popularity_by_year <- movies_data %>%
  group_by(year) %>%
  summarise(average_popularity = mean(popularity, na.rm = TRUE))

average_popularity_by_year <- average_popularity_by_year %>% filter(year < 2017)
```

```{r Cr√©er un graphique de la popularit√© moyenne des films par ann√©e}
ggplot(average_popularity_by_year, aes(x = as.numeric(year), y = average_popularity)) +
  geom_line(stat = 'identity', color="darkblue") +
  geom_smooth(method = "lm", se = FALSE, color = "blue", linetype = "dashed") +
  geom_point() +
  labs(title = "√âvolution de la Popularit√© des Films par Ann√©e",
       x = "Ann√©e",
       y = "Popularit√© Moyenne") +
  theme_minimal() +
  theme_gray() 
```


**Analyse**

On obtient comme une courbe stable entre les ann√©es 1900 ‚Äì 1920, √©tant donn√© que le dataset ne comporte pas assez d‚Äôinformations sur la popularit√© des films sur cette p√©riode. Aussi, on peut constater qu‚Äôavant les ann√©es 1980, les films √©taient plus reconnus compar√© √† nos jours peut-√™tre d√ª au fait qu‚Äôon n‚Äôen produisait pas assez ou qu‚Äôon avait pas une large possibilit√© de choix. On peut le remarquer par la pr√©sence de nombreux pics sur cette p√©riode. Alors qu‚Äôapr√®s les ann√©es 1980, de nombreux pays s‚Äôadh√®rent √† la r√©alisation des films. On pourrait alors parler d‚Äôune forme de concurrence entre ceux-ci. Ceci pouvant s'expliquer par une certaine stabilit√© de la popularit√© des films sur cet intervalle.

Nous allons essayer de comprendre la ou les raisons des pics a certaines p√©riodes donn√©es sur le graphique.

Entre les ann√©es 1925 ‚Äì 1950, on a des pics de popularit√©. En effet, l'industrie cin√©matographique a connu une √©volution significative de genres embl√©matiques tels que le film noir, la com√©die musicale, le western et le screwball comedy. Les studios hollywoodiens ont domin√© l'industrie et ont produit des films caract√©ris√©s par des narrations lin√©aires, des stars de cin√©ma embl√©matiques. 

Puis, Les ann√©es 1950-1970 ont √©t√© marqu√©es par l'√©mergence de mouvements cin√©matographiques comme la Nouvelle Vague fran√ßaise, le cin√©ma d'auteur et le cin√©ma ind√©pendant. Les films ont explor√© des sujets sociaux et politiques, et de nouveaux genres comme le film d'horreur moderne ont vu le jour. 

Ensuite, Les ann√©es 1980 - 1990 ont √©t√© domin√©es par les blockbusters hollywoodiens, avec l'√©mergence de franchises embl√©matiques comme Star Wars, Indiana Jones et Jurassic Park. Les genres populaires comprenaient l'action, la science-fiction et les films pour adolescents. 

Au cours des deux derni√®res d√©cennies, l'industrie cin√©matographique s'est diversifi√©e avec l'√©mergence de nouveaux genres et styles de films. Les films de super-h√©ros sont devenus omnipr√©sents, tandis que le cin√©ma ind√©pendant a continu√© √† prosp√©rer avec des films exp√©rimentaux et innovants. De plus, les avanc√©es technologiques ont permis de nouveaux genres comme les films en 3D et les films d'animation num√©rique.

Pour une meilleure appr√©ciation de la popularit√© des films au cours des ann√©es, nous avons r√©alis√© une distribution de celle ‚Äì ci sur tous les 5 ans afin de savoir s‚Äôil y a eu des films qui ont √©t√© plus populaires que d‚Äôautres sur cet intervalle de temps ou bien s‚Äôil √©tait en moyenne autour de la m√™me valeur.

```{r Extraire ann√©e de la date de sortie}
movies$release_date <- as.Date(movies$release_date)
movies$year <- format(movies$release_date, "%Y")
year<- movies$year
```

```{r Changer ou modifier la dur√©e des tranches et creation du graphique de la distribution de la popularite des films }
intervalles <- seq(1900, 2020, by = 5)
plot_interactif <- ggplot(data = movies, aes(x = (cut(as.numeric(year), breaks = intervalles)), y = popularity)) +
  geom_boxplot(fill = "brown", color = "black", size = 0.3) +  
  labs(x = "Ann√©es ", y = "Popularit√© du film", title = "Distribution de la popularit√© des films tous les 5 ans") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
plotly_plot <- ggplotly(plot_interactif, tooltip = c())
plotly_plot
```


**Analyse**

Pour l'affichage du graphique, nous n'avons consid√©r√© la popularit√© qu'entre 0 et 250 car ce n'est que dans cet intervalle que les points sont repr√©sent√©s. Aussi, cette d√©cision a √©t√© prise afin d'obtenir une meilleure appr√©ciation et lisibilit√© de la popularit√© moyenne des films.

On constate qu‚Äô√† partir de l‚Äôann√©e 1970 jusqu‚Äô√† nos jours, il y a des films qui sont plus populaires que d‚Äôautres avec l'√©mergence de mouvements cin√©matographiques. Les genres populaires comprennent l'action, la science-fiction pour adolescents. Les films de super-h√©ros sont devenus omnipr√©sents et les styles de films en 3D. Alors qu‚Äôavant les ann√©es 1970, nous √©tions dans une certaine suffisance ce qui pourrait justifier la raison pour laquelle il n‚Äôy a pas de films plus populaires que d‚Äôautres au cours de cette p√©riode-l√†.

Cela nous am√®ne √† une nouvelle question qui est de savoir le nombre de films r√©alis√©s par pays chaque ann√©e.

Attente : On s‚Äôattend √† avoir les √âtats-Unis pour avoir r√©alis√© le plus de films chaque ann√©e du fait qu‚Äôils soient tr√®s pr√©sents sur des p√©riodes √©mergentes de la cin√©matographie et √† une hausse de production de films dans les ann√©es 2000.

Pour r√©aliser une comparaison, nous avons utilis√© un geom_bar(). Les variables utilis√©es, telles que le pays de production et la date, sont respectivement des variables qualitatives nominales et quantitatives continues. 

Au cours du pr√©traitement, nous avons constat√© la pr√©sence de textes JSON dans la variable de pays de production. De ce fait, nous avons cr√©er une fonction pour nettoyer la colonne. Ensuite, nous devons compter le nombre de fois qu‚Äôun pays intervient dans la r√©alisation d‚Äôun film √† une ann√©e donn√©e et le repr√©senter.

```{r Fonction pour nettoyer la colonne en ne gardant que les lettres majuscules}
clean_countries <- function(countries) {
  cleaned <- gsub("[^A-Z]", "", countries)
  return(cleaned)
}
```

```{r S√©parer la liste de fa√ßon propre }
movies_data$production_countries <- gsub("\\[|\\]", "", movies_data$production_countries)
movies_data <- movies_data %>%
  separate_rows(production_countries, sep = ", ") %>%
  filter(production_countries != "")

movies_data$release_date <- as.Date(movies_data$release_date)
movies_data$year <- format(movies_data$release_date, "%Y")
year <- movies_data$year
```

```{r Compter le nombre de films r√©alis√©s par pays de production et par ann√©e }
films_par_pays_par_annee <- movies_data %>%
  group_by(year, production_countries) %>%
  summarise(nombre_de_films = n()) %>%
  ungroup()

films_par_pays_par_annee$production_countries <- sapply(films_par_pays_par_annee$production_countries, clean_countries)

films_par_pays_par_annee <- films_par_pays_par_annee %>%
  group_by(production_countries, year) %>%
  filter(sum(nombre_de_films) > 5)
```

```{r creation du graphique du nombre de films r√©alis√©s par pays et par ann√©e }
plot_interactif <- ggplot(films_par_pays_par_annee, aes(x = as.numeric(year), y = nombre_de_films, fill = production_countries)) +
  geom_bar(stat = "identity") +
  scale_fill_brewer(palette = "Paired")+
  labs(x = "Ann√©e", y = "Nombre de films r√©alis√©s", fill = "Pays", title = " Nombre de films r√©alis√©s par pays et par ann√©e ") +
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
plotly_plot <- ggplotly(plot_interactif, tooltip = c())
plotly_plot
```


**Analyse**

On remarque qu‚Äôeffectivement, ce sont les √âtats-Unis qui r√©alisent le plus de films sur les ann√©es. Aussi, on constate que la production des films a doubl√© √† partir de l‚Äôann√©e 1997 et tripl√© √† partir des ann√©es 2000.
Les espaces vides pr√©sents sur le graphique peuvent s‚Äôexpliquer par le manque de valeurs √† ces instants. De plus, le graphique ne repr√©sente que les pays qui ont r√©alis√© plus de 5 films sur une ann√©e donn√©e pour √©viter la surcharge et obtenir une meilleure visibilit√© car avant les ann√©es 1960, les pays producteurs r√©alisaient moins de 5 films par ann√©e.
M√™me si la pr√©pond√©rance des √âtats-Unis est notable, il convient de souligner qu'√† partir des ann√©es 2000, les pays producteurs se diversifient.

---

Pour la suite de notre analyse, nous allons maintenant mettre l'accent sur les compagnies de production. En effet, nous allons chercher √† savoir si elles ont vari√© leur genre de films au fil du temps. Pour ce faire, nous avons jug√© qu'il serait plus int√©ressant de nous concentrer sur les compagnies ayant produit le plus de films, √©tant donn√© le nombre important de compagnies de production. Pour cela, nous avons r√©alis√© au pr√©alable un graphique √† barres affichant le nombre de films produits par compagnie de production et par ann√©e.

Attente : Nous nous attendons √† ce que les compagnies de production am√©ricaines aient produit le plus de films au fil des ann√©es, √©tant donn√© le nombre important de pays producteurs de films. 

Pour r√©aliser une comparaison, nous avons utilis√© un geom_bar(). Les variables utilis√©es, telles que la compagnie de production et la date, sont respectivement des variables qualitatives nominales et quantitatives continues.

Durant la r√©daction du code, nous avons filtr√© le dataset de sorte qu‚Äôil ne contienne que les compagnies de production ayant r√©alis√© plus de 5 films, afin de rendre le graphique plus lisible et compr√©hensible.

```{r cr√©ation du graphique du nombre de films r√©alis√©s par compagnie de production et par ann√©e }
country_data <- data %>%
  mutate(release_date = as.Date(release_date))
country_data <- country_data %>%
  mutate(production_companies = strsplit(gsub("\\[|\\]|'", "", production_companies), ", "))
country_data <- country_data %>%
  unnest_longer(production_companies)
count_data <- country_data %>%
  group_by(year = year(release_date), companies = production_companies) %>%
  summarize(count = n()) %>%
  ungroup()
count_data_filtered <- count_data %>%
  group_by(companies, year) %>%
  filter(sum(count) > 5)
plot_interactif <- ggplot(count_data_filtered, aes(x = year, y = count, fill = companies)) +
  geom_bar(stat = "identity") + 
  labs(title = "Nombre de films produits par compagnie de production et par ann√©e",
       x = "Ann√©e",
       y = "Nombre de films") +
  theme_minimal() 
plotly_plot <- ggplotly(plot_interactif, tooltip = c())
plotly_plot
```

**Analyse**

Il ressort de ce graphique que ce sont principalement les compagnies de production am√©ricaines, notamment Universal Pictures, Warner Bros., Paramount Pictures et New Line Cinema, qui ont r√©alis√© le plus de films au fil du temps. Nous recensons √©galement des compagnies fran√ßaises, telles que Canal+.

Maintenant que nous connaissons les compagnies qui produisent le plus de films, nous allons examiner si elles ont vari√© leurs genres de films au fil du temps. Pour ce faire, nous allons r√©aliser un graphique √† barres group√©es qui nous permettra de comparer les genres de films utilis√©s par compagnie de production au cours du temps.

Attente : Nous nous attendons √† ce que ces compagnies √©largissent leur champ de genres de films, notamment pour √™tre en lien avec la tendance du march√©, et produire des films qui r√©pondent aux d√©sirs des spectateurs.

Pour r√©aliser une comparaison, nous avons utilis√© un geom_bar(). Les variables utilis√©es, telles que la compagnie de production et le genre de films sont des variables qualitatives nominales et la date est une variable quantitative continue. 

Pendant la r√©daction du code, nous avons fusionn√© les lignes contenant ¬´ Science ¬ª et ¬´ Fiction ¬ª s√©par√©ment pour former le genre ¬´ Science-fiction ¬ª. Ensuite, nous avons cr√©√© une fonction pour tracer un graphique √† barres group√©es des trois genres de films les plus populaires pour une compagnie donn√©e. Cela nous permet de conna√Ætre les genres les plus en vogue √† cette p√©riode et de faire des comparaisons avec d'autres ann√©es.

```{r pr√©traitement et cr√©ation dune fonction qui r√©alise le graphique du top 3 des genres de films par compagnie de production tous les 5 ans }
movies_df <- read_csv("data/movies.csv")
movies_df <- movies_df %>%
  mutate(release_date = as.Date(release_date, format = "%Y-%m-%d")) %>%
  filter(!is.na(release_date)) %>%
  mutate(year = year(release_date))
movies_df <- movies_df %>%
  mutate(genres = strsplit(as.character(genres), " "),
         production_companies = strsplit(gsub("\\[|\\]|'", "", production_companies), ", "))
movies_exploded <- movies_df %>%
  unnest_longer(genres) %>%
  unnest_longer(production_companies)
movies_exploded <- movies_exploded %>%
  mutate(genres = ifelse(genres == "Science" | genres == "Fiction", "Science Fiction", genres))
movies_exploded <- movies_exploded %>%
  filter(genres != "",production_companies != "")
genre_trend <- movies_exploded %>%
  group_by(year, production_companies, genres) %>%
  summarise(count = n(), .groups = 'drop') %>%
  pivot_wider(names_from = genres, values_from = count, values_fill = list(count = 0))
plot_genre_trends <- function(company_name, data) {
  if (!company_name %in% data$production_companies) {
    print(paste("No data available for", company_name))
    return(NULL)
  }
  company_data <- data %>%
    filter(production_companies == company_name) %>%
    select(-production_companies)
  company_data_long <- company_data %>%
    pivot_longer(cols = -year, names_to = "genre", values_to = "count")
  company_data_top3 <- company_data_long %>%
    group_by(year) %>%
    top_n(3, count) %>%
    ungroup()
  intervalles <- seq(1900, 2020, by = 5)  
  plot_interactif <- ggplot(company_data_top3, aes(x = (cut(as.numeric(year), breaks = intervalles)), y = count, fill = genre)) +
    geom_bar(stat = "identity", position = position_dodge()) +
    labs(title = paste("Top 3 Genre Trends Over Time for", company_name),
         x = "Year",
         y = "Number of Films") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
  plotly_plot <- ggplotly(plot_interactif, tooltip = c("year", "genre", "count"))
  plotly_plot
}
```

Nous allons r√©aliser les graphiques de trois compagnies en nous concentrant sur les ann√©es de d√©but, de fin, ainsi que les ann√©es ayant les chiffres les plus √©lev√©s. Nous allons commencer par la compagnie :

Walt Disney Pictures est une grande compagnie de production cin√©matographique am√©ricaine fond√©e en 1923 par Walt Disney et Roy O. Disney. Elle produit des films en prises de vues r√©elles, souvent orient√©s vers des publics familiaux et jeunes, incluant des franchises populaires comme "Pirates des Cara√Øbes".

```{r cr√©ation du graphique du top 3 des genres de films pour Walt Disney Pictures tous les 5 ans }
plot_genre_trends('Walt Disney Pictures', genre_trend)

```

**Analyse**

Nous constatons que :
Entre 1935 et 1940, Walt Disney Pictures a principalement produit des films d'aventure, familiaux et musicaux.

De 2000 √† 2005, la compagnie a connu un pic de production de films familiaux, suivis par des films d'aventure et des com√©dies. En parall√®le, il y a √©galement eu des films de science-fiction, fantastiques, dramatiques, d'action et d'animation.

Entre 2015 - 2020, Le genre fantastique se distingue √©galement avec une forte repr√©sentation dans la production de cette p√©riode, suivis par des films d'aventure, de famille. La limitation du nombre de genres observ√©s pourrait √™tre attribu√©e √† un manque de donn√©es dans le jeu de donn√©es, ce qui ne permet pas de capturer toute la diversit√© des genres produits par la compagnie durant cette p√©riode.

En conclusion, l'analyse des productions de Walt Disney Pictures r√©v√®le une pr√©dominance des films familiaux, suivis par les films d'aventure et de com√©die. Les genres fantastique et musical sont √©galement bien repr√©sent√©s. La diversit√© des genres produits par la compagnie est notable, bien que les films familiaux restent les plus fr√©quents sur l'ensemble du dataset. Les limitations de donn√©es peuvent restreindre la capture compl√®te de la diversit√© des genres produits par la compagnie.


Ensuite, nous allons continuer avec la compagnie Warner Bros. 
Warner Bros. est un grand studio de cin√©ma et de t√©l√©vision fond√© en 1923. Il produit une large gamme de films, incluant des genres comme l'action, le fantastique, la com√©die, le drame, l'animation, et la science-fiction. Il est connu pour des franchises populaires telles que "Harry Potter", "Batman", et "Matrix".

```{r cr√©ation du graphique du top 3 des genres de films pour Warner Bros. Pictures tous les 5 ans }
plot_genre_trends('Warner Bros.', genre_trend)

```

**Analyse**

Nous constatons que :
Entre 1930-1935, Warner Bros. se lance dans la production de films et s'accentue sur la r√©alisation de films de genre com√©die, musique et romance. 

Entre 1935-1940, ce sont les films de genres action, guerre, aventure et drame qui ont √©t√© r√©alis√©s, marquant un changement par rapport aux genres des ann√©es pr√©c√©dentes.

Entre 2005-2010, la compagnie a r√©alis√© davantage de films de drame et de thriller, puis des films de crime et de science-fiction, en plus des genres pr√©c√©dents. 

Entre 2010-2015, Warner Bros. se concentre principalement sur les films de drame et de science-fiction, tout en incluant des films de genre romantique et les genres des ann√©es pr√©c√©dentes.

En conclusion, l'√©volution des genres de films produits par Warner Bros. au fil des d√©cennies refl√®te une adaptation aux tendances et aux attentes du march√© cin√©matographique. Ainsi, elle a d√©montr√© une capacit√© √† √©voluer et √† r√©pondre aux changements des go√ªts du public, tout en maintenant une diversit√© dans ses genres de films au fil des d√©cennies.


Enfin, nous allons terminer avec la compagnie Canal+.
Canal+ est une cha√Æne de t√©l√©vision fran√ßaise, fond√©e en 1984, qui a d√©but√© la production de films en 1990. Elle est connue pour produire une vari√©t√© de genres de films, notamment des com√©dies, des drames, des films d'action, des thrillers et des films d'auteur. Canal+ joue un r√¥le important dans le soutien et la promotion du cin√©ma.

```{r cr√©ation du graphique du top 3 des genres de films pour Canal+ sur tous les 5 ans }
plot_genre_trends('Canal+', genre_trend)

```

**Analyse**

Entre 1990-1995, Canal+ a r√©alis√© des films de divers genres pour s'ins√©rer dans l‚Äôindustrie cin√©matographique. Les genres les plus produits sont l'aventure et la science-fiction. √Ä c√¥t√© de ces genres dominants, ils ont √©galement produit des films de guerre, d‚Äôaction, de com√©die, de crime, de drame, de fantastique, de romance et de thriller.

Entre 2005-2010, Canal+ a continu√© √† r√©aliser de nombreux films, avec une hausse notable dans le genre dramatique. D'autres genres produits incluent les films historiques, de famille et de drame.

Entre 2010-2015, le genre dramatique a de nouveau connu un pic important. Les films d‚Äôaction et de thriller ont √©galement √©t√© produits en grand nombre. D'autres genres pr√©sents sont les films criminels, d‚Äôhorreur, de myst√®re et de science-fiction.

Cette analyse montre que Canal+ a diversifi√© sa production de films au fil du temps, en adaptant ses choix de genres pour r√©pondre aux tendances du march√© et aux attentes des spectateurs.

Apr√®s ces diff√©rentes comparaisons malgr√© diff√©rents pays de production, nous comprenons donc que ces compagnies cherchent non seulement √† √©largir leur type de genre de films mais aussi se conformer √† la tendance du march√©. √âtant donn√© que la plupart de ces compagnies produise les m√™mes genres de films √† un moment donn√© et ne cherchent qu‚Äô√† g√©n√©rer et √† augmenter leurs profits.


### Analyse des mots employ√©s dans les films

Dans cette partie, nous nous interrogerons sur la fr√©quence des mots-cl√©s (variables qualitatives nominales) utilis√©s en fonction du genre (variables qualitatives nominales). √âtant donn√© que ce dataset contient 21 genres distincts, nous pencherons principalement sur les genres Adventure, Fantasy et Science-Fiction. Nous nous attendons √† ce que chaque genre utilise des mots-cl√©s d'un m√™me champ lexical ou d'un m√™me univers. 

```{r traitement_keywords}
data_keywords <- data %>% select(genres, keywords)
keywords_list_by_genre <- c()
j <- 1

for (i in c(2, 3, 4)) {
  for (j in 1:nrow(data_keywords)) {
    if (grepl(genre_list[i], data_keywords$genres[j])) {
      keywords_list_by_genre[i] <- paste(keywords_list_by_genre[i], data_keywords$keywords[j])
    }
  }
}
```

```{r wordcloud_adventure, warning=FALSE}
keywords_aventure <- unlist(str_split(keywords_list_by_genre[2], ' '))
keywords_aventure <- keywords_aventure[keywords_aventure != ""]

layout(matrix(c(1, 2), nrow=2), heights=c(1,25))
par(mar=rep(0, 4))
plot.new()
text(x=0.5, y=0.5, "Nuage des mots-cl√©s des films d'aventure")

set.seed(1234)
wordcloud(keywords_aventure, max.words = 100, colors=brewer.pal(8, "Dark2"),  rot.per=0)
```

On remarque que le genre Adventure contient un grand nombre de films en rapport avec les comics, les superh√©ros et Marvel, la dystopie, la guerre, l'espace et la magie. On peut donc facilement les relier avec des films appartenant au Marvel Cinematic Universe (comics, superhero, marvel), Avatar ou Star Wars (war, space), Harry Potter (magic) et Mad Max ou Hunger Games (dystopia).


```{r wordloud_fantasy, warning=FALSE}
keywords_fantasy <- unlist(str_split(keywords_list_by_genre[3], ' '))
keywords_fantasy <- keywords_fantasy[keywords_fantasy != ""]

layout(matrix(c(1, 2), nrow=2), heights=c(1,25))
par(mar=rep(0, 4))
plot.new()
text(x=0.5, y=0.5, "Nuage des mots-cl√©s des films fantastiques")

set.seed(1234)
wordcloud(keywords_fantasy, max.words = 100, colors=brewer.pal(8, "Dark2"),  rot.per=0)
```

On remarque que les mots-cl√©s se d√©marquant sont ceux appartenant √† un univers fantastique/l√©gendaire (vampire, monster, witch, fairy) ainsi que ceux indiquant des relations (relationship, love, brother, friendship, father). On peut donc en d√©duire que ces films se concentrent sur des cr√©atures l√©gendaires tout en mettant l'accent sur l'√©volution des relations entre personnages qui se cr√©ent tout au long du film. Par ailleurs, on peut √©galement constater que beaucoup de ces films du genre Fantasy sont des adaptations de livres (based on a novel).

```{r wordcloud_sciencefiction, warning=FALSE}
keywords_scifi <- unlist(str_split(keywords_list_by_genre[4], ' '))
keywords_scifi <- keywords_scifi[keywords_scifi != ""]

layout(matrix(c(1, 2), nrow=2), heights=c(1,25))
par(mar=rep(0, 4))
plot.new()
text(x=0.5, y=0.5, "Nuage des mots-cl√©s des films de science-fiction")

set.seed(1234)
wordcloud(keywords_scifi, max.words = 100, colors=brewer.pal(8, "Dark2"),  rot.per=0)
```

On remarque que les films de science-fiction sont pour beaucoup d√©crits comme une dystopie en rapport avec l'espace, les aliens (mutant, zombie, robot, android) ou le futur (time, artificial, technology, robot). Parmi eux, on peut citer Startrek ou Men In Black (space), Transformers ou Independance day (alien), Le Cinqui√®me √âl√©ment (The Fifth Element) ou Avatar (future).

**Analyse**
√Ä travers ces 3 nuages de mots, on peut constater que les mots-cl√©s d√©crivent les films d'un m√™me genre avec un champ lexical semblable. On devrait donc √™tre capable de classer les films par genre cin√©matographique √† partir de ces mots-cl√©s.

---

Nous allons ensuite chercher √† savoir si certains mots-cl√©s ressortent dans les films d'une compagnie de production particuli√®re ou pour un r√©alisateur donn√©, et peut-√™tre d√©terminer s'il existe un lien avec les pays de production.

Dans un premier temps, nous allons v√©rifier s'il existe r√©ellement certains mots-cl√©s qui ressortent des compagnies de production. √âtant donn√© que nous souhaitons simplement identifier les mots-cl√©s fr√©quents dans les films, nous avons choisi de visualiser ces mots sous forme de nuage de mots. Cela permet de les afficher avec une taille et une couleur particuli√®re, les rendant distincts les uns des autres. Les mots les plus fr√©quents appara√Ætront en plus grande taille.

Attente : Nous nous attendons √† ce qu'il y ait des mots-cl√©s utilis√©s par les compagnies de production et les r√©alisateurs comme une marque de fabrique dans les films o√π ils ont √©t√© impliqu√©s. Cependant, nous anticipons moins de liens par rapport aux pays de production.

Pour r√©aliser une comparaison, nous avons utilis√© un geom_bar(). Les variables utilis√©es, telles que les compagnies de production, les pays de production, les mots-cl√©s et les r√©alisateurs sont des variables qualitatives nominales.

Durant la r√©daction du code, nous avons effectu√© un pr√©traitement des colonnes et cr√©√© des fonctions pour tracer des nuages de mots des mots-cl√©s pour chaque compagnie, r√©alisateur et pays de production.

```{r Pr√©traitement des colonnes production_company, production_countries, director }
movies_df <- read_csv("data/movies.csv")
clean_countries <- function(countries) {
  cleaned <- gsub("[^A-Z]", "", countries)
  return(cleaned)
}
movies_df <- movies_df %>%
  mutate(keywords = strsplit(gsub("\\[|\\]|'", "", keywords), " "),
         production_companies = strsplit(gsub("\\[|\\]|'", "", production_companies), ", "),
         director = gsub("\\[|\\]|'", "", director),
         production_countries= gsub("\\[|\\]|'", "", production_countries)) %>%
  separate_rows(production_countries, sep = ", ") %>%
  filter(production_countries != "")
movies_exploded <- movies_df %>%
  unnest_longer(keywords) %>%
  unnest_longer(production_companies)%>%
  unnest_longer(production_countries)
```

```{r Fonction pour tracer un wordcloud des mots-cl√©s pour une compagnie de production donne }
top_keywords_by_company <- function(company_name, data) {
    excluded_keywords <- c("novel", "and", "of", "on", "based", "love", "new", "the")
company_data <- data[data$production_companies == company_name, ]
   keywords <- unlist(company_data$keywords)
   corpus <- Corpus(VectorSource(keywords))
    corpus <- tm_map(corpus, content_transformer(tolower))
    corpus <- tm_map(corpus, removePunctuation)
    corpus <- tm_map(corpus, stripWhitespace)
    corpus <- tm_map(corpus, removeWords, excluded_keywords)
    tdm <- TermDocumentMatrix(corpus)
    m <- as.matrix(tdm)
    word_freq <- sort(rowSums(m), decreasing = TRUE)
    d <- data.frame(word = names(word_freq), freq = word_freq)
    top_keywords <- head(d, 100)
    wordcloud(words = top_keywords$word, freq = top_keywords$freq, random.order = FALSE, rot.per = 0.3, 
              scale = c(4, 0.5), max.words = 100, colors = brewer.pal(8, "Dark2"))
   title(main = paste("Word Cloud -", company_name), font.main = 1, cex.main = 1.5)
  }
```

Nous allons commencer par la compagnie Walt Disney Pictures.

```{r cr√©ation du graphique de Walt Disney Pictures 1}
 top_keywords_by_company('Walt Disney Pictures', movies_exploded)

```

**Analyse**

Nous constatons qu'aucun mot ne d√©signe sp√©cifiquement une marque de fabrique pour cette compagnie. Toutefois, le langage des mots-cl√©s est ax√© sur des films de genres musique, famille (friend, family) et fantastique (witch, fairy, princess, magic, queen, hero‚Ä¶), indiquant une orientation vers un public jeune (teenage).

Pour confirmer cette observation, nous avons r√©alis√© un graphique √† barres montrant les mots les plus fr√©quents associ√©s √† cette compagnie.

```{r Fonction pour obtenir un bar plot des mots-cl√©s les plus fr√©quents pour une compagnie de production donn√©e}
  top_keywords_by_company_barplot <- function(company_name, data, top_n = 10) {
  excluded_keywords <- c("novel", "and", "of", "on", "based", "love", "new", "the") 
  company_data <- data %>%
    filter(production_companies == company_name)
  keywords <- unlist(company_data$keywords)
  keywords <- keywords[!is.na(keywords)]
  keywords <- keywords[!keywords %in% excluded_keywords]
  keyword_counts <- table(keywords)
  most_common_keywords <- sort(keyword_counts, decreasing = TRUE)[1:top_n]
  top_keywords_df <- data.frame(keyword = names(most_common_keywords), frequency = as.numeric(most_common_keywords))
  plot <- ggplot(top_keywords_df, aes(x = reorder(keyword, frequency), y = frequency, fill = keyword)) +
    geom_bar(stat = "identity") +
    scale_fill_viridis_d(option = "viridis") +  
    labs(title = paste("Top 10 Mots-Cl√©s pour", company_name),
         x = "Mots-Cl√©s",
         y = "Fr√©quence") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
  return(plot)
}
```

```{r cr√©ation du graphique de Walt Disney Pictures 2}
plot <- top_keywords_by_company_barplot('Walt Disney Pictures', movies_exploded)
print(plot)

```

**Analyse**
Nous voyons bien que tous ses mots-cl√©s refl√®tent des mots des films de genres musique, famille et fantastique.


Ensuite, nous avons r√©alis√© le nuage de mots pour la compagnie Warner Bros.

```{r creation du graphique de Warner Bros. 1}
  top_keywords_by_company('Warner Bros.', movies_exploded)
```

Nous constatons qu‚Äôelle n‚Äôa pas de mot d√©signant une marque de fabrique mais plut√¥t un langage de mots ax√© sur des films de genre science-fiction, drame, guerre, thriller, crime pour un public tr√®s diversifi√©, allant des enfants aux adultes, en couvrant une large gamme de genres et de styles. Elle s'efforce de r√©pondre aux go√ªts vari√©s de leur audience mondiale avec des productions allant des blockbusters grand public aux films plus niche et sp√©cialis√©s.

Pour confirmer cette observation, nous avons r√©alis√© un bar chart montrant les mots les plus fr√©quents associ√©s √† cette compagnie.

```{r creation du graphique de Warner Bros. 2}
plot <- top_keywords_by_company_barplot('Warner Bros.', movies_exploded)
print(plot)

```

**Analyse**

Nous parvenons tout de m√™me √† identifier des mots tels que comics, war, et magic, qui refl√®tent bien le genre de films produits par Warner Bros. Ces mots mettent en √©vidence l'orientation de la compagnie vers des films de super-h√©ros, de guerre, et de fantastique, confirmant ainsi la diversit√© de leur catalogue tout en soulignant des th√®mes r√©currents caract√©ristiques de leurs productions. 

Enfin, nous avons r√©alis√© le nuage de mots pour la compagnie Canal+.

```{r creation du graphique de Canal+ 1}
  top_keywords_by_company('Canal+', movies_exploded)
```

**Analyse**

Nous constatons √©galement que Canal+ n‚Äôa pas de mot d√©signant une marque de fabrique sp√©cifique, mais utilise plut√¥t un langage de mots ax√© sur une vari√©t√© de genres de films, notamment des com√©dies, des drames, des films d'action, des thrillers et des films d'auteur. De plus, elle joue un r√¥le important dans le soutien et la promotion du cin√©ma am√©ricain et fran√ßais.

Pour confirmer cette observation, nous avons r√©alis√© un bar chart montrant les mots les plus fr√©quents associ√©s √† cette compagnie.

```{r creation du graphique de Canal+ 2}
plot <- top_keywords_by_company_barplot('Canal+', movies_exploded)
print(plot)

```

**Analyse**

Nous constatons que la compagnie Canal+ utilise une grande vari√©t√© de mots cl√©s, refl√©tant une diversit√© de genres de films, y compris des productions am√©ricaines. Cela est compr√©hensible √©tant donn√© qu'elle est une cha√Æne de production t√©l√©vis√©e qui joue un r√¥le important dans le soutien et la promotion du cin√©ma.

**Analyse finale des mots employ√©s par les compagnies de production **

En r√©sum√©, ces analyses r√©v√®lent plusieurs points communs :
Canal+ utilise une large gamme de mots-cl√©s pour refl√©ter la diversit√© des genres de films qu'elle produit, y compris la publication de films am√©ricains. 

Warner Bros. est identifiable par l'utilisation fr√©quente de mots-cl√©s tels que "comics", "war", et "magic". Ces termes mettent en lumi√®re l'orientation de la compagnie vers les films de super-h√©ros, de guerre et de fantastique, confirmant ainsi la diversit√© de leur catalogue et soulignant des th√®mes r√©currents caract√©ristiques de leurs productions.

Les mots-cl√©s associ√©s √† Walt Disney sont principalement li√©s aux genres de musique, de famille et de fantastique, refl√©tant une coh√©rence th√©matique dans leurs productions de films.

Ces observations montrent comment les choix de mots-cl√©s peuvent non seulement refl√©ter les genres de films mais aussi d√©voiler les orientations strat√©giques et th√©matiques distinctives des compagnies de production cin√©matographique.


Dans un second temps, nous allons chercher √† savoir s‚Äôil y a r√©ellement certains mots cl√©s qui ressortent des r√©alisateurs les plus populaires comme George Miller, Christpoher Nolan, Kyle Balda... Pour ce faire, nous nous sommes concentr√©s sur des graphiques √† barres, car nous avons constat√© durant notre analyse qu‚Äôil n‚Äôy avait pas √©norm√©ment de mots qui ressortaient des r√©alisateurs. Il serait donc plus int√©ressant de visualiser la fr√©quence de ces mots-cl√©s de mani√®re pr√©cise et claire.

Attente : Nous nous attendons √† ce qu'il y ait des mots-cl√©s propres √† chaque r√©alisateur comme des marques de fabrique ind√©pendamment du genre de films auquel il est associ√©. 

```{r Fonction pour tracer un barplot des mots-cl√©s pour un realisateur donne }
top_keywords_by_director_barplot <- function(director_name, data, top_n = 10) {
  excluded_keywords <- c("novel", "and", "of", "on", "based", "love", "new", "the") 
  director_data <- data %>%
    filter(director == director_name)
  keywords <- unlist(director_data$keywords)
  keywords <- keywords[!is.na(keywords)]
  keywords <- keywords[!keywords %in% excluded_keywords]
  keyword_counts <- table(keywords)
  most_common_keywords <- sort(keyword_counts, decreasing = TRUE)[1:top_n]
  top_keywords_df <- data.frame(keyword = names(most_common_keywords), frequency = as.numeric(most_common_keywords))
  plot <- ggplot(top_keywords_df, aes(x = reorder(keyword, frequency), y = frequency, fill = keyword)) +
    geom_bar(stat = "identity") +
    scale_fill_viridis_d(option = "magma") +  # Utiliser la palette "viridis"
    labs(title = paste("Top 10 Mots-Cl√©s pour le r√©alisateur", director_name),
         x = "Mots-Cl√©s",
         y = "Fr√©quence") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
   return(plot)
}
``` 

Nous allons commencer par le r√©alisateur George Miller.

```{r Tracer pour George Miller}
plot_director <- top_keywords_by_director_barplot('George Miller', movies_exploded)
print(plot_director)

```

**Analyse**

Nous constatons que George Miller n'est pas associ√© √† un mot-cl√© distinctif mais est plut√¥t li√© aux genres de films auxquels il a contribu√©, notamment la science-fiction et l'action, comme en t√©moignent les mots-cl√©s r√©currents tels que dystopia, postapocalyptic, et chase dans ce dataset.

Les "after-credits stingers" sont devenus un moyen populaire pour les cin√©astes de maintenir l'engagement du public, de cr√©er des attentes pour les suites, et d‚Äôajouter une couche suppl√©mentaire de storytelling. Ils encouragent √©galement les spectateurs √† rester jusqu'√† la fin du g√©n√©rique, honorant ainsi le travail de toute l'√©quipe du film.


Enfin, nous avons r√©alis√© un graphique √† barres pour le r√©alisateur Christopher Nolan.

```{r Tracer pour Christopher Nolan}
plot_director <- top_keywords_by_director_barplot('Christopher Nolan', movies_exploded)
print(plot_director)

```

**Analyse**
Nous constatons aussi que Christopher Nolan n'est pas associ√© √† un mot-cl√© distinctif mais est plut√¥t li√© aux genres de films auxquels il a contribu√©, notamment la science-fiction, l'aventure et de drame, comme en t√©moignent les mots-cl√©s r√©currents tels que comics, secret, crime, fighter, dans ce dataset.


**Analyse finale des mots employ√©s par les r√©alisateurs**

En r√©sum√©, notre analyse montre que Christopher Nolan et George Miller ne sont pas √©troitement associ√©s √† des mots-cl√©s sp√©cifiques, mais plut√¥t aux genres de films auxquels ils ont contribu√©. Tous deux sont particuli√®rement li√©s √† la science-fiction, avec des √©l√©ments r√©currents tels que "comics" pour Nolan et "dystopia" pour Miller. Ils partagent √©galement une implication dans des genres comme l'action et le drame, indiquant une certaine diversit√© th√©matique malgr√© l'absence de mot-cl√© distinctif pour chacun. Ces constats mettent en lumi√®re leurs influences marquantes dans le paysage cin√©matographique contemporain, tout en refl√©tant leur capacit√© √† explorer divers aspects narratifs et visuels au sein de leurs ≈ìuvres.


Enfin, nous allons explorer si ces mots-cl√©s sont li√©s aux pays de production. Nous avons donc cr√©√© des nuages de mots pour analyser les termes les plus fr√©quemment utilis√©s par les √âtats-Unis et la France, en lien avec notre √©tude.

Attente : Bien que cette analyse ne soit pas tr√®s pertinente, nous cherchons √† savoir s'il pourrait exister des liens des liens avec les pays de production.

```{r Fonction pour tracer un wordcloud des mots-cl√©s pour un pays producteur donne }
  top_keywords_by_countries <- function(countries_name, data) {
    excluded_keywords <- c("novel", "and", "of", "on", "based", "love", "new", "the") 
    countries_data <- data[data$production_countries == countries_name, ]
    keywords <- unlist(countries_data$keywords)
    corpus <- Corpus(VectorSource(keywords))
    corpus <- tm_map(corpus, content_transformer(tolower))
    corpus <- tm_map(corpus, removePunctuation)
    corpus <- tm_map(corpus, stripWhitespace)
    corpus <- tm_map(corpus, removeWords, excluded_keywords)
    tdm <- TermDocumentMatrix(corpus)
    m <- as.matrix(tdm)
    word_freq <- sort(rowSums(m), decreasing = TRUE)
    d <- data.frame(word = names(word_freq), freq = word_freq)
    top_keywords <- head(d, 100)
    wordcloud(words = top_keywords$word, freq = top_keywords$freq, random.order = FALSE, rot.per = 0.3, 
              scale = c(4, 0.5), max.words = 100, colors = brewer.pal(8, "Dark2"))
    title(main = paste("Word Cloud -", countries_name), font.main = 1, cex.main = 1.5)
  }
```

Nous allons commencer par les √âtats-Unis pour effectuer cette analyse.

```{r Tracer pour US}
      top_keywords_by_countries('US', movies_exploded)
```


**Analyse**

Pour le pays de production am√©ricain, nous constatons que les mots les plus fr√©quemment retrouv√©s dans les nuages de mots des √âtats-Unis sont similaires √† ceux retrouv√©s dans les compagnies de production am√©ricaines. Toutefois, cette observation s'est r√©v√©l√©e peu int√©ressante, car elle n'a apport√© aucune information pertinente, probablement en raison d'un manque de donn√©es dans l'ensemble √©tudi√©.


Nous terminons notre analyse avec la France.

```{r Tracer pour FR}
      top_keywords_by_countries('FR', movies_exploded)
```


**Analyse**

Pour la production cin√©matographique fran√ßaise, nous remarquons aussi que les mots les plus fr√©quemment pr√©sents dans les nuages de mots de la France sont similaires √† ceux des compagnies de production fran√ßaises et am√©ricaines, en raison de son r√¥le dans la promotion des films. Toutefois, cette observation s'est r√©v√©l√©e peu int√©ressante, car elle n'a apport√© aucune information pertinente, probablement en raison d'un manque de donn√©es dans l'ensemble √©tudi√©.


---

# Conclusion

Pour rappel, ce projet avait pour objectif de r√©aliser une exploration du monde du cin√©ma pour d√©couvrir le dessous des films √† succ√®s. 

Nous avons d√©couper notre exploration en trois grandes parties : 

- **Analyse du succ√®s des films :** Nous avons essay√© dans cette partie de comprendre ce qui pouvait influer la popularit√© d'un film ou la note qui lui est attribu√©e. Pour cela, nous avons analys√© le budget, les revenus, les r√©alisateurs populaires ou encore les genres populaires afin de comprendre les "lois" du succ√®s des films.

- **Analyse des tendances temporelles :** Nous avons pu constater ici plusieurs √©volutions, telles que l'augmentation du budget et des revenus des films au cours du temps, mais aussi des "blockbusters" qui, certaines ann√©es, influent grandement les tendances. Nous avons aussi pu mettre en avant l'apparition de nouveaux genres de films et l'√©mergence de nouvelles maisons de production. Enfin, nous avons √©tudi√© d'autres changements dans le temps tels que le nombre de films pr√©sents ou encore la dur√©e de ces derniers.

- **Analyse des mots employ√©s pour d√©crire le film :** Nous avons essay√© de chercher √† savoir s'il y avait des mots-cl√©s qui caract√©risaient des maisons de production, les r√©alisateurs et peut-√™tre les pays de production comme des marques de fabrique mais nous avons compris qu'ils √©taient plut√¥t associ√©s aux genres de films auquels ils ont contribu√©.

La principale difficult√© de notre jeu de donn√©es est l'absence de d√©finition claire de ce que signifie la "popularit√©". Nous avons donc du choisir nous m√™me une d√©finition qui nous semblait coh√©rente. Ensuite, nous avions des disparit√©s de nombre de films selon les ann√©es, ce qui rendait l'analyse des tendances plus d√©licate pour les ann√©es ant√©rieures √† 1980. Enfin, une partie des variables de notre dataset √©tait sous format JSON ou sous forme de liste de mots, ce qui a demand√© des pr√©traitements relativement importants selon les graphiques √† r√©aliser. 

Afin d'am√©liorer notre projet, il aurait √©t√© pertinent d'ajouter d'autres jeux de donn√©es pour permettre de compl√©ter les p√©riodes manquantes et limiter les disparit√©s de notre jeu de donn√©es actuel. Nous pourrions √©galement √©largir notre analyse et nous int√©resser √† l'impact de l'apparition des plateformes de streaming dans l'industrie cin√©matographique. De plus, un jeu de donn√©es plus r√©cent nous aurait permis d'analyser les cons√©quences du Covid pendant et apr√®s la p√©riode du Covid. 

# Retours du projet

**Elo√Øse : ** Ce projet a √©t√© l'occasion pour moi de d√©couvrir l'application shiny et de cr√©er ainsi un dashboard interactif complet avec lequel l'utilisateur peut int√©ragir. Il aurait √©t√© int√©ressant de travailler sur un jeu de donn√©es plus r√©cent, afin de r√©ellement √©tudier l'impact de l'apparition des plateformes de streaming dans l'industrie cin√©matographique, et aussi de voir les effets g√©n√©r√©s par la p√©riode Covid.

**Laure : ** Ce projet m'a permis d'approfondir mes connaissances dans le langage R, autant pour le traitement de donn√©es que pour la cr√©ation de graphiques. Il aurait √©t√© int√©ressant de compl√©ter notre dataset avec d'autres jeux de donn√©es afin de pouvoir analyser l'industrie du cin√©ma de fa√ßon plus compl√®te.

**Gaudeline Maeva : ** Ce projet m'a offert l'opportunit√© de manipuler et de visualiser des donn√©es avec un autre langage (le langage R) et de d√©couvrir des applications de visualisation telles que Tableau.

**Belvine : ** Grace √† ce projet, j'ai decouvert un nouvel langage(R) et appris de nouvelles notions et applications de ce langaage.

---

# Annexe

### Elo√Øse 

Dans ce projet, j'ai eu l'occasion de travailler sur plusieurs parties : 

- L'√©tude du lien entre note et popularit√©

- L'√©tude du lien entre note et budget

- L'√©tude du lien entre budget et popularit√©

- L'√©tude du lien entre budget et revenus

- L'√©tude de l'√©volution du budget et des revenus et des b√©n√©fices des films dans le temps avec la cr√©ation du dashboard shiny

- L'√©tude du film par pays qui a g√©n√©r√© les plus gros revenus, budget et l'identification du lien entre les 2

- Contribution √† la correction des autres parties du code, √† la r√©daction de l'introduction et de la conclusion

### Laure

- √âtude des r√©alisateurs les plus populaires en fonction du genre

- √âtude des genres les plus populaires

- √âtude du budget et du revenu par genre

- √âtude des mots-cl√©s les plus fr√©quents en fonction du genre

- R√©alisation d'un dashboard Tableau

- Contribution √† la correction des autres parties du code et √† la r√©daction de la conclusion

### Gaudeline Maeva

- Quels sont les pays qui ont r√©alis√© le plus de films en fonction des ann√©es ?

- Est-ce qu‚Äôil y a une √©volution de la popularit√© des films dans le temps ?

- Quels sont les maisons de production qui ont r√©alis√©es le plus de films en fonction des ann√©es ?

- Est-ce que les maisons de production ont vari√© le genre de leurs films au fil du temps ?

- Est-ce que certains mots-cl√©s ressortent dans les films de telle ou telle compagnie de production ou pour tel r√©alisateur ? Cela a-t-il un lien avec le pays de production ?

- Est-ce que les mots-cl√©s utilis√©s ont une influence sur l‚Äôappr√©ciation ou la note du film ?

- Quels sont les pays qui ont r√©alis√© le plus de films en fonction des ann√©es ?

### Belvine

- Evolution de la dur√©e des films dans le temps

-Lien entre le budget et la dur√©e d'un film

-Lien entre la note et les acteurs du film

-Diff√©rence de la dur√©e des films dans diff√©rents pays

- est ce que la dur√©e d'un film est fonction du genre du film?
